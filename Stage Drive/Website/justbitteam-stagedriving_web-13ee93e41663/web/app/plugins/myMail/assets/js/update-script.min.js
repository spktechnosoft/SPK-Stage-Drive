jQuery(document).ready(function(d){window.onbeforeunload=function(){return"You have to finish the update before you can use MyMail 2!"};if(typeof mymail_updates=="undefined"){return}d(document).ajaxError(function(){e.append("script paused...continues in 5 seconds<br>");setTimeout(function(){e.empty();m(b,true)},5000)});var r=d("#output"),e=d("#error-list"),i=d("#mymail_nonce").val(),g=[],o,b,p=d('<span>&nbsp;</span><a class="skipbutton button button-small" href title="skip this step">skip</a>'),a=false,k=mymail_updates_performance[0]||1,l=d.map(mymail_updates,function(u,t){return t});function h(){m(0);r.on("click",".skipbutton",function(){a=true;return false})}function m(t,v){var u=l[t];b=t;if(!(o=mymail_updates[u])){n();return}if(!v){j(u,"<strong>"+o+"</strong> ...",true)}s(u,function(){setTimeout(function(){m(++t)},1000)},function(){q()},1)}function s(w,u,t,v){c("batch_update",{id:w,performance:k},function(x){if(x&&x.success){if(x.output){f(x.output)}if(a){j(w," &otimes;",false);a=false;u&&u()}else{if(x[w]){j(w," &#10004;",false);u&&u()}else{j(w,".",false,v);setTimeout(function(){s(w,u,t,++v)},5)}}}else{t&&t()}},function(x,z,y){f(x.responseText);alert("There was an error while doing the update! Please check the textarea on the right for more info!");q()})}function q(){window.onbeforeunload=null;j("error","error",true)}function n(){window.onbeforeunload=null;j("finished","<strong>alright, all updates have been finished!</strong>",true,0,true);j("finished_button",'<a href="edit.php?post_type=newsletter&page=mymail_welcome" class="button button-primary">Ok, fine!</a>',true,0,true)}function j(y,x,u,t,v){var w=d("#output_"+y).length?d("#output_"+y):d('<div id="output_'+y+'" class="'+(v?"":"updated inline")+'" style="padding: 0.5em 6px;word-wrap: break-word;"></div>').appendTo(r);w.append(x);t>20?w.append(p.show()):p.hide()}function f(u){var t=d("#textoutput").val();u=u+"\n\n"+t;d("#textoutput").val(d.trim(u))}function c(v,u,w,t){if(d.isFunction(u)){if(d.isFunction(w)){t=w}w=u;u={}}d.ajax({type:"POST",url:ajaxurl,data:d.extend({action:"mymail_"+v,_wpnonce:i},u),success:function(y,z,x){w&&w.call(this,y,z,x)},error:function(x,z,y){if(z=="error"&&!y){return}if(console){console.error(d.trim(x.responseText))}t&&t.call(this,x,z,y)},dataType:"JSON"})}h()});