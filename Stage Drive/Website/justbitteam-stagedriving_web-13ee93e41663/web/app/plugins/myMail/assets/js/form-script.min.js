jQuery(document).ready(function(g){var n=g("#ID").val(),c=g("#form_form"),b=g("#form-builder"),v=g("#form-structure"),j=g("#form-fields");c.on("submit",function(){window.onbeforeunload=null});b.find(".sortable").sortable({containment:g("#form_form"),connectWith:".sortable",placeholder:"ui-state-highlight",start:function(B,C){b.addClass("dragging")},stop:function(B,C){b.removeClass("dragging")},receive:function(B,C){v.find("input").each(function(){g(this).attr("name",g(this).data("name"))});j.find("input").each(function(){g(this).removeAttr("name")})},update:function(B,C){A()},remove:function(B,C){}});v.on("click",".submitbutton input",function(){event.preventDefault();g(this).focus().select()}).on("click",".field-remove",function(){event.preventDefault();var B=g(this).parent().parent().parent();B.appendTo(j.find("ul"));B.find("input").removeAttr("name")});function A(B){window.onbeforeunload=function(){return mymailL10n.require_save}}var w="",l,d=g("input#style"),y=g(".add-custom-style"),f=g("#custom-style"),s=g("#custom-style-prefix"),z=g("#custom-style-samples"),m=g("#form-design-iframe"),o,h=g(".designnav"),r=g(".designtab"),k=g(".color-field"),x=g("[data-selector]");m.on("load",function(){l=g('<style id="mymail_form_preview_css"></style>').appendTo(m.contents().find("head"));u();m.contents().find("style.mymail-custom-form-css").remove()});y.on("click",function(){var C=g(this).parent().find(".color-field"),B=".mymail-form-"+n+" "+C.data("selector")+"{\n    \n}\n";f.val(f.val()+s.val()+B)});h.on("click","a.nav",function(){h.find("a").removeClass("nav-tab-active");r.hide();var B=g(this).addClass("nav-tab-active").attr("href");g("#"+B.substr(1)).show();return false}).find("a.nav").eq(0).trigger("click");k.wpColorPicker({clear:function(B,C){u()},change:function(B,C){clearTimeout(o);o=setTimeout(function(){u();A()},20)}});g("#themestyle").on("change",function(){m.attr("src",m.attr("src").replace(/&s=(1|0)/,"&s="+(g(this).prop("checked")?1:0)))});f.on("change",function(){u();A()});z.find("option").on("click",function(){f.val(f.val()+s.val()+".mymail-form-"+n+g(this).val()+"{\n    \n}\n");f[0].scrollTop=f[0].scrollHeight});g("#title").on("change",A);g("#form-builder").on("change","input",A);g("#form-options").on("change","input",A).on("change",".mymail_userschoice",function(){var B=g(this).is(":checked");g(this).parent().parent().parent().parent().find("legend.mymail_userschoice_td").hide().eq(B?1:0).show();g(this).parent().parent().find(".mymail_dropdown").prop("disabled",!B);g(this).parent().parent().parent().parent().find(".mymail_precheck").prop("disabled",(B?0:1))}).on("change","#redirect-cb",function(){g("#redirect-tf").prop("disabled",!g(this).is(":checked"))}).on("change",".double-opt-in",function(){(!parseInt(g(this).val(),10))?g("#double-opt-in-field").slideUp(200):g("#double-opt-in-field").slideDown(200)}).on("change",".vcard",function(){(g(this).is(":checked"))?g("#vcard-field").slideDown(200):g("#vcard-field").slideUp(200)});function u(){w="";var B={};g.each(x,function(){var G=g(this),C=G.data("selector"),E=G.data("property"),F=G.data("postfix")||"",D=G.val();if(!D){return}B[C]=B[C]||{};B[C][E]=D+F});g.each(B,function(C,D){w+="form.mymail-form.mymail-form-"+n+" "+C+"{\n";g.each(D,function(F,E){w+="\t"+F+": "+E+";\n"});w+="}\n"});w+=f.val().replace(/(<([^>]+)>)/ig,"");l.html(w);d.val(escape(JSON.stringify(B)));m[0].height=m[0].contentWindow.document.body.scrollHeight+"px"}var t=g(".button-options-wrap").find("input"),a=g(".button-preview"),i=g(".code-preview").find("textarea"),e=g(".shortcode-preview").find("input");t.on("change",q);g(".subscriber-button-style").on("change","input",q);i.on("click",function(){g(this).select()});e.on("click",function(){g(this).select()});g("#form-html").on("change",".embed-form-input",function(){var D=g(this).parent().parent().parent(),B=D.find(".embed-form-input"),C=D.find(".embed-form-output");C.val(p(C.data("embedcode"),B.eq(0).val(),B.eq(1).val(),(B.eq(2).is(":checked")?"&style=1":"")))}).on("click",".embed-form-output",function(){g(this).select()}).on("click",".form-output",function(){g(this).select()}).find(".embed-form-input").eq(0).trigger("change");q();function q(){var C=window.mymaildata.embedcode,B=g("#ID").val(),D=g("#buttonwidth").val()||480,E="[newsletter_button id="+B,H=g("#showcount").prop("checked"),F=g("input[name=subscriber-button-style]:checked").val(),G=g("#ontop").prop("checked"),I=g("input[name=buttonlabel]:checked").val()=="custom",J=I?g("#buttonlabel").val():g("#buttonlabel").attr("placeholder");J=J?J.replace(/(<([^>]+)>)/ig,""):"";F=F+(G?" ontop":"");if(window.MyMailSubscribe&&window.MyMailSubscribe.loaded){window.MyMailSubscribe.destroy()}a.html("");C=C.replace("%ID%",B).replace("%SHOWCOUNT%",H?' data-showcount="1"':"").replace("%WIDTH%",D!=480?' data-width="'+D+'"':"").replace("%DESIGN%",F!="default"?' data-design="'+F+'"':"").replace("%LABEL%",J);a.html(C);i.val(C);if(F&&F!="default"){E+=' design="'+F+'"'}if(I){E+=' label="'+J+'"'}if(H){E+=' showcount="'+H+'"'}if(D!=480){E+=' width="'+D+'"'}E+="]";e.val(E)}function p(){var B=Array.prototype.slice.call(arguments),C=B.shift();while(B.length){C=C.replace("%s",B.shift())}return C}});