jQuery(document).ready(function(d){var a=d(".mainnav"),h=d("#deliverynav"),j=d(".tab"),i=d("#tab-delivery").find(".subtab"),e=d("#mymail_nonce").val(),b=d("#reserved-tags").data("tags");d("a.external").on("click",function(){window.open(this.href);return false});d("form").on("submit",function(){return false});d(window).load(function(){if(d("#settingsloaded").length){d(".submit-form").prop("disabled",false);d("form").off("submit")}else{alert("error loading settings page")}});h.on("click","a.nav-tab",function(){h.find("a").removeClass("nav-tab-active");i.hide();var l=d(this).addClass("nav-tab-active").attr("href");d("#deliverymethod").val(l.substr(1));d("#subtab-"+l.substr(1)).show();return false});a.on("click","a",function(){a.find("li").removeClass("active");j.hide();var m=d(this).parent().addClass("active").find("a").attr("href");d("#tab-"+m.substr(1)).show();location.hash=m;d("form").attr("action","options.php"+m);if(m=="#system_info"){var l=d("#system_info_content");if(d.trim(l.val())){return}l.val(mymailL10n.loading+"...");f("get_system_info",function(n){if(n.log&&console){console.log(n.log)}l.val(n.msg)})}return false});d(".settings-tabs").find('a[href^="#"]').on("click",function(){a.find('a[href="'+d(this).attr("href")+'"]').trigger("click")});if(location.hash=="#forms"&&confirm("The forms are no longer on the settings page. Go there?")){location.href="edit.php?post_type=newsletter&page=mymail_forms"}(location.hash&&a.find('a[href="'+location.hash+'"]').length)?a.find('a[href="'+location.hash+'"]').trigger("click"):a.find("a").eq(0).trigger("click");d(".system_mail").on("change",function(){d(".system_mail_template").prop("disabled",d(this).val()==0)});d("#mymail_geoip").on("change",function(){(d(this).is(":checked"))?d("#mymail_geoipcity").prop("disabled",false):d("#mymail_geoipcity").prop("disabled",true).prop("checked",false)});d("#mymail_geoip").on("change",function(){(d(this).is(":checked"))?d("#load_country_db").prop("disabled",false):d("#load_country_db").prop("disabled",true).prop("checked",false)});d("#mymail_geoipcity").on("change",function(){(d(this).is(":checked"))?d("#load_city_db").prop("disabled",false):d("#load_city_db").prop("disabled",true).prop("checked",false)});d("#load_country_db, #load_city_db").on("click",function(){var n=d(this),l=d(".geo-ajax-loading").css({visibility:"visible"}),m=n.data("type");d("button").prop("disabled",true);f("load_geo_data",{type:m},function(o){d("button").prop("disabled",false);l.css({visibility:"hidden"});n.prop("disabled",false).html(o.buttontext);var p=d('<div class="'+((!o.success)?"error":"updated")+'"><p>'+o.msg+"</p></div>").hide().prependTo(n.parent()).slideDown(200).delay(200).fadeIn().delay(4000).fadeTo(200,0).delay(200).slideUp(200,function(){p.remove()});if(o.success){if(o.path){d("#"+m+"_db_path").val(o.path)}}},function(o,r,p){d("button").prop("disabled",false);l.css({visibility:"hidden"});n.prop("disabled",false);var q=d('<div class="error"><p>'+r+" "+o.status+": "+p+"</p></div>").hide().prependTo(n.parent()).slideDown(200).delay(200).fadeIn().delay(4000).fadeTo(200,0).delay(200).slideUp(200,function(){q.remove()})});return false});d("#upload_country_db_btn").on("click",function(){d("#upload_country_db").removeClass("hidden");return false});d("#upload_city_db_btn").on("click",function(){d("#upload_city_db").removeClass("hidden");return false});d(".has-archive-check").on("change",function(){(d(this).is(":checked"))?d(".archive-slug").slideDown(200):d(".archive-slug").slideUp(200)});d(".edit-slug").on("click",function(){d(this).parent().parent().find("span").hide().filter(".edit-slug-area").show().find("input").focus().select()});d(".users-register").on("change",function(){(d(this).is(":checked"))?d("#"+d(this).data("section")).slideDown(200):d("#"+d(this).data("section")).slideUp(200)});d("#mymail_dkim").on("change",function(){(d(this).is(":checked"))?d(".dkim-info").slideDown(200):d(".dkim-info").slideUp(200)});d("#mymail_spf").on("change",function(){(d(this).is(":checked"))?d(".spf-info").slideDown(200):d(".spf-info").slideUp(200)});d("#bounce_active").on("change",function(){(d(this).is(":checked"))?d("#bounce-options").slideDown(200):d("#bounce-options").slideUp(200)});d("#mymail_generate_dkim_keys").on("click",function(){return(d("#dkim_keys_active").length&&confirm(mymailL10n.create_new_keys));return false});d("input.smtp.secure").on("change",function(){d("#mymail_smtp_port").val(d(this).data("port"))});d("#capabilities-table").on("mouseenter","label",function(){d("#current-cap").stop().html(d(this).attr("title")).css("opacity",1).show()}).on("mouseleave","tbody",function(){d("#current-cap").fadeOut()}).on("change","input.selectall",function(){var l=d(this);d("input.cap-check-"+l.val()).prop("checked",l.prop("checked"))});d(".mymail_sendtest").on("click",function(){var n=d(this),l=d(".test-ajax-loading").css({visibility:"visible"}),m=n.data("role")=="basic",o=(m)?d("#mymail_testmail").val():d("#mymail_authenticationmail").val();n.prop("disabled",true);f("send_test",{test:true,basic:m,to:o},function(p){if(p.log&&console){p.success?console.log(p.log):console.error(p.log)}l.css({visibility:"hidden"});n.prop("disabled",false);var q=d('<div class="'+((!p.success)?"error":"updated")+'"><p>'+p.msg+"</p></div>").hide().prependTo(n.parent()).slideDown(200).delay(200).fadeIn().delay(4000).fadeTo(200,0).delay(200).slideUp(200,function(){q.remove()})},function(p,s,q){l.css({visibility:"hidden"});n.prop("disabled",false);var r=d('<div class="error"><p>'+s+" "+p.status+": "+q+"</p></div>").hide().prependTo(n.parent()).slideDown(200).delay(200).fadeIn().delay(4000).fadeTo(200,0).delay(200).slideUp(200,function(){r.remove()})})});d("#bounce_ssl").on("change",function(){d("#bounce_port").val(d(this).is(":checked")?"995":"110")});d(".mymail_bouncetest").on("click",function(){var n=d(this),l=d(".bounce-ajax-loading").css({visibility:"visible"}),m=d(".bouncetest_status").show();n.prop("disabled",true);f("bounce_test",{},function(o){k(o.identifier,1,function(){n.prop("disabled",false)})},function(o,q,p){l.css({visibility:"hidden"});n.prop("disabled",false);m.html(q+" "+o.status+": "+p)})});d(".sortable").sortable({containment:"parent"});d("input.cron_radio").on("change",function(){d(".cron_opts").hide();d("."+d(this).val()).show()});d("#mymail_add_tag").on("click",function(){var l=d('<div class="tag"><code>{<input type="text" class="tag-key">}</code> &#10152; <input type="text" class="regular-text tag-value"> <a class="tag-remove">&#10005;</a></div>').insertBefore(d(this));l.find(".tag-key").focus()});d(".tags").on("change",".tag-key",function(){var n=d(this),l=n.parent().parent(),m=c(n.val());if(!m){n.parent().parent().remove()}n.val(m);l.find(".tag-value").attr("name","mymail_options[custom_tags]["+m+"]")}).on("click",".tag-remove",function(){d(this).parent().remove();return false});d("#mymail_add_field").on("click",function(){var l=d('<div class="customfield"><a class="customfield-move-up" title="'+mymailL10n.move_up+'">&#9650;</a><a class="customfield-move-down" title="'+mymailL10n.move_down+'">&#9660;</a><div><span class="label">'+mymailL10n.fieldname+':</span><label><input type="text" class="regular-text customfield-name"></label></div><div><span class="label">'+mymailL10n.tag+':</span><span><code>{</code><input type="text" class="customfield-key code"><code>}</code></span></div><div><span class="label">'+mymailL10n.type+':</span><select class="customfield-type"><option value="textfield">'+mymailL10n.textfield+'</option><option value="textarea">'+mymailL10n.textarea+'</option><option value="dropdown">'+mymailL10n.dropdown+'</option><option value="radio">'+mymailL10n.radio+'</option><option value="checkbox">'+mymailL10n.checkbox+'</option><option value="date">'+mymailL10n.datefield+'</option></select></div><ul class="customfield-additional customfield-dropdown customfield-radio"><li><ul class="customfield-values"><li><span>&nbsp;</span> <span class="customfield-value-box"><input type="text" class="regular-text customfield-value" value=""> <label><input type="radio" value="" title="'+mymailL10n.default_selected+'" class="customfield-default" disabled> '+mymailL10n.default_field+'</label></span></li></ul><span>&nbsp;</span> <a class="customfield-value-add">'+mymailL10n.add_field+'</a></li></ul><div class="customfield-additional customfield-checkbox"><span>&nbsp;</span><label><input type="checkbox" value="1" title="'+mymailL10n.default_field+'" class="customfield-default" disabled> '+mymailL10n.default_checked+'</label></div><a class="customfield-remove">remove field</a><br></div>').appendTo(d(".customfields").eq(0));l.find(".customfield-name").focus()});d("#sync_list_check").on("change",function(){d("#sync_list").slideToggle(200);d(".sync-button").prop("disabled",true)});d("#sync_list").on("click","#add_sync_item",function(){var l=d(".mymail_syncitem");l.eq(0).clone().insertAfter(l.last()).removeAttr("title").find("select").each(function(){d(this).attr("name",d(this).attr("name").replace("[synclist][0]","[synclist]["+l.length+"]"))});d(".sync-button").prop("disabled",true)}).on("click",".remove-sync-item",function(){d(this).parent().remove();d(".sync-button").prop("disabled",true)}).on("change","select",function(){d(".sync-button").prop("disabled",true)}).on("click","#sync_subscribers_wp",function(){if(event.target==this&&!confirm(mymailL10n.sync_subscriber)){return false}var m=d(this),l=d(".sync-ajax-loading").css({visibility:"visible"});d(".sync-button").prop("disabled",true);f("sync_all_subscriber",{offset:m.data("offset")},function(n){d(".sync-button").prop("disabled",false);if(n.success&&n.count){m.data("offset",n.offset).trigger("click")}else{l.css({visibility:"hidden"});m.data("offset",0)}},function(n,p,o){l.css({visibility:"hidden"});d(".sync-button").prop("disabled",false)});return false}).on("click","#sync_wp_subscribers",function(){if(event.target==this&&!confirm(mymailL10n.sync_wp_user)){return false}var m=d(this),l=d(".sync-ajax-loading").css({visibility:"visible"});d(".sync-button").prop("disabled",true);f("sync_all_wp_user",{offset:m.data("offset")},function(n){d(".sync-button").prop("disabled",false);if(n.success&&n.count){m.data("offset",n.offset).trigger("click")}else{l.css({visibility:"hidden"});m.data("offset",0)}},function(n,p,o){l.css({visibility:"hidden"});d(".sync-button").prop("disabled",false)});return false});d(".customfields").on("change",".customfield-name",function(){var m=d(this),l=m.parent().parent().parent().find(".customfield-key");if(!l.val()){l.val(m.val()).trigger("change")}}).on("change",".customfield-key",function(){var n=d(this),l=n.parent().parent().parent(),m=c(n.val());if(!m){n.parent().parent().remove()}n.val(m);l.find(".customfield-name").attr("name","mymail_options[custom_field]["+m+"][name]");l.find(".customfield-type").attr("name","mymail_options[custom_field]["+m+"][type]");l.find(".customfield-value").attr("name","mymail_options[custom_field]["+m+"][values][]");l.find(".customfield-default").attr("name","mymail_options[custom_field]["+m+"][default]")}).on("click",".customfield-remove",function(){d(this).parent().remove()}).on("click",".customfield-move-up",function(){var l=d(this).parent();l.insertBefore(l.prev())}).on("click",".customfield-move-down",function(){var l=d(this).parent();l.insertAfter(l.next())}).on("change",".customfield-type",function(){var l=d(this).val();d(this).parent().parent().find(".customfield-additional").slideUp(200).find("input").prop("disabled",true);if(l!="textfield"){d(this).parent().parent().find(".customfield-"+l).stop().slideDown(200).find("input").prop("disabled",false)}}).on("change",".customfield-value",function(){d(this).next().find("input").val(d(this).val())}).on("click","a.customfield-value-remove",function(){d(this).parent().parent().remove()}).on("click","a.customfield-value-add",function(){var l=d(this).parent().find("li").eq(0).clone();l.appendTo(d(this).parent().find("ul")).find("input").val("").focus().select()});function k(n,o,q){var p=d(this),l=d(".bounce-ajax-loading").css({visibility:"visible"}),m=d(".bouncetest_status");f("bounce_test_check",{identifier:n,passes:o},function(r){m.html(r.msg);if(r.complete){l.css({visibility:"hidden"});q&&q()}else{setTimeout(function(){k(n,++o,q)},1000)}},function(r,t,s){l.css({visibility:"hidden"});p.prop("disabled",false);m.html(t+" "+r.status+": "+s)})}function c(m){var l=d.trim(m).toLowerCase().replace(/ /g,"-").replace(/[^a-z0-9_-]*/g,"");if(d.inArray(l,b)!=-1){alert(g(mymailL10n.reserved_tag,'"'+l+'"'));l+="-a"}return l}function f(n,m,o,l){if(d.isFunction(m)){if(d.isFunction(o)){l=o}o=m;m={}}d.ajax({type:"POST",url:ajaxurl,data:d.extend({action:"mymail_"+n,_wpnonce:e},m),success:function(q,r,p){o&&o.call(this,q,r,p)},error:function(p,r,q){if(r=="error"&&!q){return}if(console){console.error(d.trim(p.responseText))}l&&l.call(this,p,r,q)},dataType:"JSON"})}function g(){var l=Array.prototype.slice.call(arguments),m=l.shift();while(l.length){m=m.replace("%s",l.shift())}return m}});