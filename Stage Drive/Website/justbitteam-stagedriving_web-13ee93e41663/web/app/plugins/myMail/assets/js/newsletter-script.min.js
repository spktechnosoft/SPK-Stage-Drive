jQuery(document).ready(function(O){var ac=O(window),D=O("body"),A=O("#mymail_iframe"),V=O("#template-wrap"),aa=A.contents().find("body"),n,y=O("#mymail_template .inside"),f=!!O("#mymail_disabled").val(),S=O("#title"),L=O("#mymail_subject"),X=O("#mymail_preheader"),U=O("#content"),b=O("#excerpt"),Z=O("#modules"),ab=O("#plain-text-wrap"),K=O("#html-wrap"),o=O("#head"),s=O("#optionbar"),F=[],T=O("#post_ID").val(),al=0,c=O("#clickmap-stats"),a=O('[name^="mymail_data"]'),m=O(".mymail-color"),C=O("#mymail_nonce").val(),E=false,ag,B,G,g,i,J,ad=O.browser.webkit?D:O("html"),u,k,ai=false,t="ontouchstart" in document.documentElement,j=typeof tinymce=="object";function ah(){H(true);ae();n=(A[0].contentWindow||A[0].contentDocument);if(n.document){n=n.document}W();var ap=setTimeout(function(){if(!E){A.trigger("load")}},5000);A.load(function(){if(E){return false}if(!f){if(!g){g=new af()}if(!J){J=new ao()}if(!G){G=new an()}}else{}z();E=true;x();M(0,0);w();clearInterval(ap);if(typeof autosaveLast!="undefined"){window.autosaveLast=(typeof wp!="undefined"&&wp.autosave)?wp.autosave.getCompareString():S.val()+U.val()+b.val()}if(typeof wp!="undefined"){if(wp.autosave&&wp.autosave.server&&typeof wp.autosave.server.postChanged=="function"){window.mymail_autosave=Q();wp.autosave.server.postChanged=function(){return window.mymail_autosave!=Q()}}}if(f){S.prop("disabled",true);window.autosave=wp.autosave=function(){return true};window.onbeforeunload=null}else{}ac.trigger("resize");O("#normal-sortables").on("sortupdate",function(aq,ar){ac.trigger("resize")});V.removeClass("load")});ac.on("resize.mymail",x);window.mymail_refresh=function(){x();w()};window.mymail_hideButtons=function(){y.find(".content.mymail-btn").remove()};if(/post_status=autoresponder/.test(O("#referredby").val())){O("#mymail_delivery").find('a[href="#autoresponder"]').click()}if(O.browser.msie){D.addClass("ie")}if(t){D.addClass("touch")}}function W(){D.on("click","a.external",function(){window.open(this.href);return false}).on("change","input[name=screen_columns]",function(){ac.trigger("resize")});if(!f){S.change(function(){if(!L.val()){L.val(O(this).val())}});O("#use_pwd").on("change",function(){O("#password-wrap").slideToggle(200).find("input").focus().select()});O("#post").on("submit",function(){if(ai){return false}w()});O("#local-storage-notice").on("click",".restore-backup, .undo-restore-backup",function(){setTimeout(function(){var ar=U.val();if(!ar){E=G=false;A[0].contentWindow.location.reload()}else{R(ar,false);x()}},100)});O("#mymail_delivery").on("change","input.timezone",function(){O(".active_wrap").toggleClass("timezone-enabled")}).on("change","input.autoresponder-timezone",function(){O(".autoresponderfield-mymail_autoresponder_timebased").toggleClass("timezone-enabled")}).on("change","input.userexactdate",function(){var ar=O(this).parent().parent().parent();ar.find("span").toggleClass("disabled")});O("#editbar, #mymail_delivery").on("change",".dynamic_embed_options_taxonomy",function(){var ar=O(this),at=ar.val();ar.parent().find(".button").remove();if(at!=-1){if(ar.parent().find("select").length<ar.find("option").length-1){O(' <a class="button button-small add_embed_options_taxonomy">'+mymailL10n.add+"</a>").insertAfter(ar)}}else{ar.parent().html("").append(ar)}return false}).on("click",".add_embed_options_taxonomy",function(){var at=O(this),ar=at.prev().clone();ar.insertBefore(at).val("-1");O("<span> "+mymailL10n.or+" </span>").insertBefore(ar);at.remove();return false});O("#autoresponder-post_type").on("change",function(){var ar=O("#autoresponder-taxonomies");ar.find("select").prop("disabled",true);P("get_post_term_dropdown",{labels:false,names:true,posttype:O(this).val()},function(at){if(at.success){ar.html(at.html)}},function(at,av,au){loader(false);alert(av+" "+at.status+": "+au+"\n\n"+mymailL10n.check_console)})});O(".default-value").on("click",function(){var ar=O(this);O("#"+ar.data("for")).val(ar.data("value"))});O(".category-tabs").on("click","a",function(){var at=O(this),ar=at.attr("href");O("#mymail_delivery").find(".tabs-panel").hide();O("#mymail_delivery").find(".tabs").removeClass("tabs");at.parent().addClass("tabs");O(ar).show();O("#mymail_is_autoresponder").val((ar=="#autoresponder")?1:"");return false});O(".mymail_sendtest").on("click",function(){var at=O(this),ar=O("#delivery-ajax-loading").css({display:"inline"});at.prop("disabled",true);w();P("send_test",{ID:T,subject:L.val(),from:O("#mymail_from").val(),from_name:O("#mymail_from-name").val(),to:O("#mymail_testmail").val(),reply_to:O("#mymail_reply_to").val(),template:O("#mymail_template_name").val(),preheader:X.val(),embed_images:O("#mymail_data_embed_images").is(":checked"),issue:O("#mymail_autoresponder_issue").val(),content:U.val(),plaintext:b.val(),autoplain:O("#plaintext").is(":checked"),head:o.val()},function(au){ar.hide();at.prop("disabled",false);var av=O('<div class="'+((!au.success)?"error":"updated")+'"><p>'+au.msg+"</p></div>").hide().prependTo(at.parent()).slideDown(200).delay(200).fadeIn().delay(3000).fadeTo(200,0).delay(200).slideUp(200,function(){av.remove()})},function(au,ax,av){ar.hide();at.prop("disabled",false);var aw=O('<div class="error"><p>'+ax+" "+au.status+": "+av+"</p></div>").hide().prependTo(at.parent()).slideDown(200).delay(200).fadeIn().delay(3000).fadeTo(200,0).delay(200).slideUp(200,function(){aw.remove()})})});O(".mymail_spamscore").on("click",function(){var aw=O(this),ar=O("#delivery-ajax-loading").css({display:"inline"}),av=O("#spam_score_progress").removeClass("spam-score").slideDown(200),au=av.find(".bar");aw.prop("disabled",true);O(".score").html("");w();au.css({width:"0"}).css({width:"20%"});P("send_test",{ID:T,subject:L.val(),from:O("#mymail_from").val(),from_name:O("#mymail_from-name").val(),to:O("#mymail_testmail").val(),reply_to:O("#mymail_reply_to").val(),spamtest:true,template:O("#mymail_template_name").val(),preheader:X.val(),embed_images:O("#mymail_data_embed_images").is(":checked"),issue:O("#mymail_autoresponder_issue").val(),content:U.val(),plaintext:b.val(),autoplain:O("#plaintext").is(":checked"),head:o.val()},function(ax){if(ax.success){au.css({width:"40%"});at(ax.id,1)}else{ar.hide();av.slideUp(200);var ay=O('<div class="error"><p>'+ax.msg+"</p></div>").hide().prependTo(aw.parent()).slideDown(200).delay(200).fadeIn().delay(3000).fadeTo(200,0).delay(200).slideUp(200,function(){ay.remove()})}},function(ax,aA,ay){ar.hide();aw.prop("disabled",false);var az=O('<div class="error"><p>'+aA+" "+ax.status+": "+ay+"</p></div>").hide().prependTo(aw.parent()).slideDown(200).delay(200).fadeIn().delay(3000).fadeTo(200,0).delay(200).slideUp(200,function(){az.remove()})});function at(ay,ax){P("check_spam_score",{ID:ay},function(aA){if(aA.score){ar.hide();aw.prop("disabled",false);av.addClass("spam-score");au.css({width:(parseFloat(aA.score)*10)+"%"},400);O(".score").html("<strong>"+r(mymailL10n.yourscore,aA.score)+"</strong>:<br>"+mymailL10n.yourscores[Math.floor((aA.score/10)*mymailL10n.yourscores.length)])}else{if(ax<=5&&!aA.abort){var az=(ax*10)+50;au.css({width:(az)+"%"},ax*400+5000);setTimeout(function(){at(ay,++ax)},ax*400)}else{ar.hide();aw.prop("disabled",false);au.css({width:"100%"},10);av.slideUp(200);var aB=O('<div class="error"><p>'+aA.msg+"</p></div>").hide().prependTo(aw.parent()).slideDown(200).delay(200).fadeIn().delay(3000).fadeTo(200,0).delay(200).slideUp(200,function(){aB.remove()})}}},function(az,aC,aA){ar.hide();aw.prop("disabled",false);var aB=O('<div class="error"><p>'+aC+" "+az.status+": "+aA+"</p></div>").hide().prependTo(aw.parent()).slideDown(200).delay(200).fadeIn().delay(3000).fadeTo(200,0).delay(200).slideUp(200,function(){aB.remove()})})}});O("#mymail_data_active").on("change",function(){var ar=O(this).is(":checked");(ar)?O(".active_wrap").addClass("disabled"):O(".active_wrap").removeClass("disabled");O(".deliverydate, .deliverytime").prop("disabled",!ar)});O("#mymail_data_autoresponder_active").on("change",function(){var ar=O(this).is(":checked");(ar)?O(".autoresponder_active_wrap").addClass("disabled"):O(".autoresponder_active_wrap").removeClass("disabled")});var ap=O("input.color");var aq=O(".colors").data("original-colors");ap.wpColorPicker({color:true,width:250,mode:"hsl",palettes:aq,change:function(ar,at){O(this).val(at.color.toString()).trigger("change")},clear:function(ar,at){}});O(".wp-color-result").on("click",function(){O(this).closest("li.mymail-color").addClass("open")});ap.on("change",function(){var at=O(this);var ar=at.data("value");N(ar,at.val(),at)});if(typeof jQuery.datepicker=="object"){O("input.datepicker").datepicker({dateFormat:"yy-mm-dd",minDate:new Date(),firstDay:mymailL10n.start_of_week,showWeek:true,dayNames:mymailL10n.day_names,dayNamesMin:mymailL10n.day_names_min,monthNames:mymailL10n.month_names,prevText:mymailL10n.prev,nextText:mymailL10n.next,showAnim:"fadeIn",onClose:function(){var ar=O(this).datepicker("getDate");O(".deliverydate").html(O(this).val())}});O("input.datepicker.nolimit").datepicker("option","minDate",null)}else{O("input.datepicker").prop("readonly",false)}O("input.datepicker").on("focus",function(){O(this).removeClass("inactive").trigger("click")}).on("blur",function(){O(".deliverydate").html(O(this).val());O(this).addClass("inactive")}).on("change",function(){});O("input.deliverytime").on("blur",function(){O(document).unbind(".mymail_deliverytime")}).on("focus, click",function(aw){var ax=O(this),at=O(this)[0],ar=ax.offset().left,ay=0,av=0,au=2;if(aw.clientX-ar>23){ay=1,av=3,au=5}O(document).unbind(".mymail_deliverytime").on("keypress.mymail_deliverytime",function(az){if(az.keyCode==9){return(ay=!ay)?!k(at,3,5):(az.shiftKey)?!k(at,0,2):true}}).on("keyup.mymail_deliverytime",function(az){if(ax.val().length==1){ax.val(ax.val()+":00");k(at,1,1)}if(document.activeElement.selectionStart==2){if(ax.val().substr(0,2)>23){ax.trigger("change");return false}k(at,3,5)}});k(at,av,au)}).on("change",function(){var at=O(this),au=at.val(),ar;at.addClass("inactive");if(!/^\d+:\d+$/.test(au)){if(au.length==1){au="0"+au+":00"}else{if(au.length==2){au=au+":00"}else{if(au.length==3){au=au.substr(0,2)+":"+au.substr(2,3)+"0"}else{if(au.length==4){au=au.substr(0,2)+":"+au.substr(2,4)}}}}}ar=au.split(":");if(!/\d\d:\d\d$/.test(au)&&au!=""||ar[0]>23||ar[1]>59){at.val("00:00").focus();k(at[0],0,2)}else{at.val(au)}});O("#mymail_autoresponder_action").on("change",function(){O("#autoresponder_wrap").removeAttr("class").addClass("autoresponder-"+O(this).val())});O("#mymail_autoresponder_advanced_check").on("change",function(){O("#mymail_autoresponder_advanced").slideToggle()});O("#time_extra").on("change",function(){O("#autoresponderfield-mymail_timebased_advanced").slideToggle()});O("#mymail_autoresponder_advanced").on("click",".add-condition",function(){var ar=O(".mymail_autoresponder_condition"),au=ar.length,at=ar.last().clone();at.hide().removeAttr("id").insertAfter(ar.last()).slideDown();O.each(at.find("input, select"),function(){var av=O(this).val("").attr("name");O(this).attr("name",av.replace(/\[\d+\]/,"["+au+"]"))})}).on("click",".remove-condition",function(){O(this).parent().parent().slideUp(function(){O(this).remove()})});O("#autoresponder_wrap").on("click",".mymail_autoresponder_timebased-end-schedule",function(){var ar=O(this).is(":checked");(ar)?O(".mymail_autoresponder_timebased-end-schedule-field").slideDown():O(".mymail_autoresponder_timebased-end-schedule-field").slideUp()});O("#mymail_receivers").on("change","input.list",function(){var at=[],ay=[],au=O("#list-checkboxes").find("input, select"),av=O("#list-checkboxes").find("input.list"),ar=O("#list_extra"),ax={},aw=O("#mymail_total");O("input.list-parent-"+O(this).val()).prop("checked",O(this).prop("checked"));O.each(av,function(){var az=O(this).val();if(O(this).is(":checked")){at.push(az)}});ax.lists=at;ax.ignore_lists=O("#ignore_lists").is(":checked");if(ar.is(":checked")){O.each(O(".mymail_list_condition"),function(){var aB=O(this),az=aB.find("select"),aA=aB.find("input");ay.push({field:az.eq(0).val(),operator:az.eq(1).val(),value:aA.eq(0).val()})});ax.operator=O("#mymail_list_operator").val();ax.conditions=ay}aw.addClass("loading");H();P("get_totals",ax,function(az){z();aw.removeClass("loading").html(az.totalformated)},function(az,aB,aA){z();aw.removeClass("loading").html("?");alert(aB+" "+az.status+": "+aA+"\n\n"+mymailL10n.check_console)})}).on("change","#all_lists",function(){O("#list-checkboxes").find("input.list").prop("checked",O(this).is(":checked")).eq(0).trigger("change")}).on("change","#ignore_lists",function(){var ar=O(this).is(":checked");O("#list-checkboxes").each(function(){(ar)?O(this).slideUp(200):O(this).slideDown(200)}).find("input.list").eq(0).trigger("change")}).on("change","#mymail_list_operator",function(){O("#mymail_list_conditions").removeClass("operator-is-OR operator-is-AND").addClass("operator-is-"+O(this).val())});O("#mymail_total").on("click",function(){O("#list-checkboxes").find("input.list").eq(0).trigger("change")});O("#mymail_list_advanced").on("click",".add-condition",function(){var ar=O(".mymail_list_condition"),au=ar.length,at=ar.last().clone();at.hide().removeAttr("id").insertAfter(ar.last()).slideDown();O.each(at.find("input, select"),function(){var av=O(this).prop("disabled",false).val("").attr("name");O(this).attr("name",av.replace(/\[\d+\]/,"["+au+"]")).removeClass("hasDatepicker").removeAttr("id")})}).on("click",".remove-condition",function(){O(this).parent().parent().slideUp(function(){O(this).remove();O("#list-checkboxes").find("input.list").eq(0).trigger("change")})}).on("change.datefields","select.condition-field",function(){var ar=O(this);if(typeof jQuery.datepicker!="object"){return}if(ar.parent().find("input").data("datepicker")){ar.parent().find("input").datepicker("destroy")}if(O.inArray(ar.val(),mymaildata.datefields)!==-1){ar.parent().find("input").datepicker({dateFormat:"yy-mm-dd",firstDay:mymailL10n.start_of_week,showWeek:true,dayNames:mymailL10n.day_names,dayNamesMin:mymailL10n.day_names_min,monthNames:mymailL10n.month_names,prevText:mymailL10n.prev,nextText:mymailL10n.next,showAnim:"fadeIn"})}}).on("change","select, input",function(){O("#list-checkboxes").find("input.list").eq(0).trigger("change")}).find("select.condition-field").trigger("change.datefields");O("#list_extra").on("change",function(){if(O(this).is(":checked")){O("#mymail_list_advanced").slideDown()}else{O("#mymail_list_advanced").slideUp()}O("#list-checkboxes").find("input.list").eq(0).trigger("change")});O("#mymail_options").on("click","a.default-value",function(){var at=O(this).prev().find("input"),ar=at.data("default");at.wpColorPicker("color",ar);return false}).on("click","ul.colorschema",function(){var at=O("#mymail_options").find("input.color"),ar=O(this).find("li.colorschema-field");H();O.each(ar,function(av){var au=ar.eq(av).data("hex");at.eq(av).wpColorPicker("color",au)});z()}).on("click","a.savecolorschema",function(){var at=O.map(O("#mymail_options").find(".color"),function(au){return O(au).val()});var ar=O("#colorschema-ajax-loading").css({display:"inline"});P("save_color_schema",{template:O("#mymail_template_name").val(),colors:at},function(au){ar.hide();if(au.success){O(".colorschema").last().after(O(au.html).hide().fadeIn())}},function(au,aw,av){ar.hide();alert(aw+" "+au.status+": "+av+"\n\n"+mymailL10n.check_console)})}).on("click",".colorschema-delete",function(){if(confirm(mymailL10n.delete_colorschema)){var at=O(this).parent().parent();var ar=O("#colorschema-ajax-loading").css({display:"inline"});P("delete_color_schema",{template:O("#mymail_template_name").val(),hash:at.data("hash")},function(au){ar.hide();if(au.success){at.fadeOut(100,function(){at.remove()})}},function(au,aw,av){ar.hide();alert(aw+" "+au.status+": "+av+"\n\n"+mymailL10n.check_console)})}return false}).on("click",".colorschema-delete-all",function(){if(confirm(mymailL10n.delete_colorschema_all)){var at=O(".colorschema.custom");var ar=O("#colorschema-ajax-loading").css({display:"inline"});P("delete_color_schema_all",{template:O("#mymail_template_name").val()},function(au){ar.hide();if(au.success){at.fadeOut(100,function(){at.remove()})}},function(au,aw,av){ar.hide();alert(aw+" "+au.status+": "+av+"\n\n"+mymailL10n.check_console)})}return false}).on("change","#mymail_version",function(){var ar=O(this).val();I(ar)}).on("click","ul.backgrounds ul a",function(){O("ul.backgrounds").find("a").removeClass("active");var ar=O(this).parent().parent().data("base"),at=O(this).addClass("active").data("file");if(!at){ar=""}O("#mymail_background").val(ar+at);Y(ar+at)}).on("mouseenter","ul.backgrounds a",function(){var at=O(this).parent().parent().data("base"),ar=O(this).data("file");if(ar){O("ul.backgrounds a").eq(0).css({"background-image":"url("+at+O(this).data("file")+")"})}}).on("mouseleave","ul.backgrounds a",function(){O("ul.backgrounds a").eq(0).css({"background-image":"url("+O.trim(O("#mymail_background").val())+")"})});y.on("click","a.addbutton",function(){var at=O(this).data(),ar=at.element.find("img").length?'<a href="" editable label="Button"><img alt=""></a>':'<a href="" editable label="Button"></a>';J.open({type:"btn",offset:at.offset,element:O(ar).appendTo(at.element),name:at.name});return false}).on("click","a.addrepeater",function(){var ar=O(this).data();ar.element.clone().insertAfter(ar.element);x();return false}).on("click","a.removerepeater",function(){var ar=O(this).data();ar.element.remove();x();return false});O(".mymail-preview-iframe").on("load",function(){var aw=O(this),at=aw.contents().find("body");if(aw.is(".mobile")){var au=at.find("style").text(),ar=/@media/.test(au);if(!ar){var av=0.85;at.css({zoom:av,"-moz-transform":"scale("+av+")","-moz-transform-origin":"0 0",transform:"scale("+av+")","transform-origin":"0 0"})}}at.on("click","a",function(){var ax=O(this).attr("href");if(ax&&ax!="#"){window.open(ax)}return false})});ab.on("click","a.button",function(){var ar=b.val();b.val(mymailL10n.loading);P("get_plaintext",{html:h()},function(at){b.val(at)},function(at,av,au){b.val(ar);alert(av+" "+at.status+": "+au+"\n\n"+mymailL10n.check_console)},"HTML")}).on("change","#plaintext",function(){var ar=O(this).is(":checked");b.prop("disabled",ar)[ar?"addClass":"removeClass"]("disabled")});if(typeof wp!="undefined"&&wp.heartbeat){O(document).on("heartbeat-send",function(at,ar){if(ar.wp_autosave){ar.wp_autosave["content"]=h();ar.wp_autosave["excerpt"]=b.val();ar.mymaildata=a.serialize()}})}}else{S.prop("disabled",true);O("#change-permalinks").remove();if(typeof autosavePeriodical!="undefined"){autosavePeriodical.repeat=false}O("#show_recipients").on("click",function(){var au=O(this),at=O("#recipients-list"),ar=O("#recipients-ajax-loading");if(!at.is(":hidden")){au.removeClass("open");at.slideUp(100);return false}ar.css({display:"inline"});P("get_recipients",{id:T},function(av){au.addClass("open");ar.hide();at.html(av.html).slideDown(100)},function(av,ax,aw){ar.hide();alert(ax+" "+av.status+": "+aw+"\n\n"+mymailL10n.check_console)});return false});O("#show_clicks").on("click",function(){var au=O(this),at=O("#clicks-list"),ar=O("#clicks-ajax-loading");if(!at.is(":hidden")){au.removeClass("open");at.slideUp(100);return false}ar.css({display:"inline"});P("get_clicks",{id:T},function(av){au.addClass("open");ar.hide();at.html(av.html).slideDown(100)},function(av,ax,aw){ar.hide();alert(ax+" "+av.status+": "+aw+"\n\n"+mymailL10n.check_console)});return false});O("#show_environment").on("click",function(){var au=O(this),at=O("#environment-list"),ar=O("#environment-ajax-loading");if(!at.is(":hidden")){au.removeClass("open");at.slideUp(100);return false}ar.css({display:"inline"});P("get_environment",{id:T},function(av){au.addClass("open");ar.hide();at.html(av.html).slideDown(100)},function(av,ax,aw){ar.hide();alert(ax+" "+av.status+": "+aw+"\n\n"+mymailL10n.check_console)});return false});O("#show_geolocation").on("click",function(){var au=O(this),at=O("#geolocation-list"),ar=O("#geolocation-ajax-loading");if(!at.is(":hidden")){au.removeClass("open");at.slideUp(100);return false}ar.css({display:"inline"});P("get_geolocation",{id:T},function(av){au.addClass("open");ar.hide();at.html(av.html).slideDown(100,function(){var az,aA,aC={legend:false,region:"world",resolution:"countries",datalessRegionColor:"#ffffff",enableRegionInteractivity:true,colors:["#d7f1fc","#2BB3E7"],backgroundColor:{fill:"none",stroke:null,strokeWidth:0}},ay;var aE;google.load("visualization","1.0",{packages:["geochart","corechart"],callback:function(){aE=new google.visualization.GeoChart(document.getElementById("countries_map"));az=aA=google.visualization.arrayToDataTable(av.countrydata);if(location.hash&&(ay=location.hash.match(/region=([A-Z]{2})/))){aw(ay[1])}else{aD()}google.visualization.events.addListener(aE,"regionClick",aw)}});O("a.zoomout").on("click",function(){ax();return false});O("#countries_table").find("tbody").find("tr").on("click",function(){var aF=O(this).data("code");(aF=="unknown"||!aF)?ax():aw(aF);return false});function ax(){var aF={region:"world",displayMode:"region",resolution:"countries",colors:["#D7E4E9","#2BB3E7"]};az=aA;aD(aF);O("#countries_table").find("tr").removeClass("wp-ui-highlight");O("#mapinfo").hide();location.hash="#region="}function aw(aG){var aF={},aH=aG.region?aG.region:aG,aI;if(aH.match(/-/)){return false}aF.region=aH;(av.unknown_cities[aH])?O("#mapinfo").show().html("+ "+av.unknown_cities[aH]+" unknown locations"):O("#mapinfo").hide();aI=av.geodata[aH]?av.geodata[aH]:[];aF.resolution="provinces";aF.displayMode="markers";aF.dataMode="markers";aF.colors=["#4EBEE9","#2BB3E7"];az=new google.visualization.DataTable();az.addColumn("number","Lat");az.addColumn("number","Long");az.addColumn("string","tooltip");az.addColumn("number","Value");az.addColumn({type:"string",role:"tooltip"});az.addRows(aI);O("#countries_table").find("tr").removeClass("wp-ui-highlight");O("#country-row-"+aH).addClass("wp-ui-highlight");location.hash="#region="+aH;aD(aF)}function aD(aF){aF=O.extend(aC,aF);aE.draw(az,aF);O("a.zoomout").css({visibility:(aC.region!="world"?"visible":"hidden")})}function aB(aG){var aF=aG;O.each(regions,function(aH,aI){if(O.inArray(aG,aI)!=-1){aF=aH}});return aF}})},function(av,ax,aw){ar.hide();alert(ax+" "+av.status+": "+aw+"\n\n"+mymailL10n.check_console)});return false});O("#show_errors").on("click",function(){var au=O(this),at=O("#error-list"),ar=O("#error-ajax-loading");if(!at.is(":hidden")){au.removeClass("open");at.slideUp(100);return false}ar.css({display:"inline"});P("get_errors",{id:T},function(av){au.addClass("open");ar.hide();at.html(av.html).slideDown(100)},function(av,ax,aw){ar.hide();alert(ax+" "+av.status+": "+aw+"\n\n"+mymailL10n.check_console)});return false});O("#show_countries").on("click",function(){O("#countries_wrap").toggle();return false});O("#mymail_details").on("click",".load-more-receivers",function(){var ax=O(this),aw=ax.data("page"),au=ax.data("types"),av=ax.data("orderby"),at=ax.data("order"),ar=ax.next().css({display:"inline"});P("get_recipients_page",{id:T,types:au,page:aw,orderby:av,order:at},function(ay){ar.hide();if(ay.success){ax.parent().parent().replaceWith(ay.html)}},function(ay,aA,az){detailbox.removeClass("loading");alert(aA+" "+ay.status+": "+az+"\n\n"+mymailL10n.check_console)});return false}).on("click",".recipients-limit",function(ar){if(ar.altKey){O("input.recipients-limit").prop("checked",false);O(this).prop("checked",true)}}).on("change",".recipients-limit, select.recipients-order",function(av){var ax=O("#recipients-list"),at=O("#recipients-ajax-loading"),au=O("input.recipients-limit:checked").map(function(){return this.value}).get(),aw=O("select.recipients-order").val(),ar=O("a.recipients-order").hasClass("asc")?"ASC":"DESC";at.css({display:"inline"});O("input.recipients-limit").prop("disabled",true);P("get_recipients",{id:T,types:au.join(","),orderby:aw,order:ar},function(ay){at.hide();O("input.recipients-limit").prop("disabled",false);ax.html(ay.html).slideDown(100)},function(ay,aA,az){at.hide();alert(aA+" "+ay.status+": "+az+"\n\n"+mymailL10n.check_console)});return false}).on("click","a.recipients-order",function(){O(this).toggleClass("asc");O("select.recipients-order").trigger("change")}).on("click",".show-receiver-detail",function(){var ar=O(this),au=ar.data("id"),at=O("#receiver-detail-"+au).show();ar.parent().addClass("loading").parent().addClass("expanded");P("get_recipient_detail",{id:au,campaignid:T},function(av){ar.parent().removeClass("loading");if(av.success){at.find("div.receiver-detail-body").html(av.html).slideDown(100)}},function(av,ax,aw){at.removeClass("loading");alert(ax+" "+av.status+": "+aw+"\n\n"+mymailL10n.check_console)});return false});O("#stats").on("click","label",function(){O("#recipients-list").find("input").prop("checked",false).filter("input."+O(this).attr("class")).prop("checked",true).trigger("change")});y.on("mouseenter","a.clickbadge",function(){var ax=O(this),ar=ax.position(),aw=ax.data("p"),av=ax.data("link"),at=ax.data("clicks"),au=ax.data("total");c.find(".piechart").data("easyPieChart").update(aw);c.find(".link").html(av);c.find(".clicks").html(at);c.find(".total").html(au);c.stop().fadeIn(100).css({top:ar.top-85,left:ar.left-(c.width()/2-ax.width()/2)})}).on("mouseleave","a.clickbadge",function(){c.stop().fadeOut(400)});O("#mymail_receivers").on("click",".create-new-list",function(){var ar=O(this).hide();O(".create-new-list-wrap").slideDown();O(".create-list-type").trigger("change");return false}).on("click",".create-list",function(){var av=O(this),au=O(".create-list-type"),at="",ar=O("#mymail_total");if(au.val()==-1){return false}if(at=prompt(mymailL10n.enter_list_name,r(mymailL10n.create_list,au.find(":selected").text(),O("#title").val()))){ar.addClass("loading");P("create_list",{name:at,listtype:au.val(),id:T},function(aw){ar.removeClass("loading");var ax=O('<div class="'+((!aw.success)?"error":"updated")+'"><p>'+aw.msg+"</p></div>").hide().prependTo(O(".create-new-list-wrap")).slideDown(200).delay(200).fadeIn().delay(3000).fadeTo(200,0).delay(200).slideUp(200,function(){ax.remove()})},function(aw,ay,ax){ar.removeClass("loading");alert(ay+" "+aw.status+": "+ax+"\n\n"+mymailL10n.check_console)})}return false}).on("change",".create-list-type",function(){var at=O(this),ar=O("#mymail_total");if(at.val()==-1){return false}at.prop("disabled",true);ar.addClass("loading");P("get_create_list_count",{listtype:at.val(),id:T},function(au){at.prop("disabled",false);ar.removeClass("loading").html(au.count)},function(au,aw,av){at.prop("disabled",false);ar.removeClass("loading").html("");alert(aw+" "+au.status+": "+av+"\n\n"+mymailL10n.check_console)})});O("#mymail_total").on("click",function(){O(".create-list-type").trigger("change")});O(".piechart").easyPieChart({animate:2000,rotate:180,barColor:"#2BB3E7",trackColor:"#f3f3f3",lineWidth:9,size:75,lineCap:"square",onStep:function(ar){this.$el.find("span").text(Math.round(ar))},onStop:function(ar){this.$el.find("span").text(Math.round(ar))}});if(typeof wp!="undefined"&&wp.heartbeat){O(document).on("heartbeat-send",function(at,ar){if(ar.wp_autosave){delete ar.wp_autosave}ar.mymail={page:"edit",id:T}}).on("heartbeat-tick",function(ay,aw){if(!aw.mymail[T]){return}var au=aw.mymail[T],at=O("#stats").find(".verybold"),av=O("#stats").find(".piechart"),ar=O(".progress"),ax=(au.sent/au.total*100);O(".hb-sent").html(au.sent_f);O(".hb-opens").html(au.opens_f);O(".hb-clicks").html(au.clicks_f);O(".hb-clicks_total").html(au.clicks_total_f);O(".hb-unsubs").html(au.unsubs_f);O(".hb-bounces").html(au.bounces_f);O(".hb-geo_location").html(au.geo_location);O.each(au.environment,function(az){O(".hb-"+az).html((this.percentage*100).toFixed(2)+"%")});av.eq(0).data("easyPieChart").update(Math.round(au.open_rate));av.eq(1).data("easyPieChart").update(Math.round(au.click_rate));av.eq(2).data("easyPieChart").update(Math.round(au.unsub_rate));av.eq(3).data("easyPieChart").update(Math.round(au.bounce_rate));ar.find(".bar").width(ax+"%");ar.find("span").eq(1).html(au.sent_formatted);ar.find("var").html(Math.round(ax)+"%");e(au.clickbadges);if(au.status!=O("#original_post_status").val()&&!O("#mymail_status_changed_info").length){O('<div id="mymail_status_changed_info" class="error inline"><p>'+r(mymailL10n.statuschanged,'<a href="post.php?post='+T+'&action=edit">'+mymailL10n.click_here+"</a></p></div>")).hide().prependTo("#postbox-container-2").slideDown(200)}});wp.heartbeat.interval("fast")}}}var af=function(){var ar,at=y.offset();function aD(){s.on("click","a.template",aB).on("click","button.save-template",aA).on("mouseenter","a.save-template",aq).on("click","a.clear-modules",aw).on("click","a.preview",ay).on("click","a.undo",aC).on("click","a.redo",az).on("click","a.code",au).on("click","a.plaintext",av).on("click","a.dfw",ap);ac.on("scroll.optionbar",function(){var aE=ac.scrollTop();if(aE<at.top-50||aE>at.top+y.height()-120){if(/fixed-optionbar/.test(D[0].className)){D.removeClass("fixed-optionbar")}s.width("auto")}else{if(!/fixed-optionbar/.test(D[0].className)){D.addClass("fixed-optionbar")}s.width(y.width())}}).on("resize.optionbar",function(){at=y.offset();ac.trigger("scroll.optionbar")})}function aA(){var aH=O("#new_template_name").val();if(!aH){return false}w();var aE=O("#new_template-ajax-loading").css({display:"inline"}),aG=O("#new_template_modules").is(":checked"),aF=O("#new_template_overwrite").is(":checked"),aI=h();P("create_new_template",{name:aH,modules:aG,overwrite:aF,template:O("#mymail_template_name").val(),content:aI,head:o.val()},function(aJ){aE.hide();if(aJ.success){if(window.wp){window.wp=null}window.location=aJ.url}else{alert(aJ.msg)}},function(aJ,aL,aK){aE.hide();alert(aL+" "+aJ.status+": "+aK+"\n\n"+mymailL10n.check_console)});return false}function aC(){if(al){y.addClass("noeditbuttons");al--;R(F[al],100,false);U.val(F[al]);s.find("a.redo").removeClass("disabled");if(!al){O(this).addClass("disabled")}}return false}function az(){var aE=F.length;if(al<aE-1){y.addClass("noeditbuttons");al++;R(F[al],100,false);U.val(F[al]);s.find("a.undo").removeClass("disabled");if(al>=aE-1){O(this).addClass("disabled")}}return false}function aw(){if(confirm(mymailL10n.remove_all_modules)){y.addClass("noeditbuttons");var aE=A.contents().find("module");var aF=A.contents().find("modules");aF.slideUp(function(){aE.remove();aF.html("").show();x();w()})}return false}function ay(){var aH=O(this),aF=h(),aE=L.val(),aG=S.val();if(s.find("a.preview").is(".loading")){return false}s.find("a.preview").addClass("loading");P("set_preview",{id:T,content:aF,head:o.val(),issue:O("#mymail_autoresponder_issue").val(),subject:aE},function(aI){s.find("a.preview").removeClass("loading");O(".mymail-preview-iframe").attr("src",ajaxurl+"?action=mymail_get_preview&hash="+aI.hash+"&_wpnonce="+aI.nonce);tb_show((aG?r(mymailL10n.preview_for,'"'+aG+'"'):mymailL10n.preview),"#TB_inline?hash="+aI.hash+"&_wpnonce="+aI.nonce+"&width="+(Math.min(1200,ac.width()-50))+"&height="+(ac.height()-100)+"&inlineId=mymail_campaign_preview",null)},function(aI,aK,aJ){s.find("a.preview").removeClass("loading");alert(aK+" "+aI.status+": "+aJ+"\n\n"+mymailL10n.check_console)})}function ax(){s.remove()}function aq(){O("#new_template_name").on("focus",function(){O(document).unbind("keypress.mymail").bind("keypress.mymail",function(aE){if(aE.keyCode==13){aA();return false}})}).select().focus().on("blur",function(){O(document).unbind("keypress.mymail")})}function aB(aE){var aF=O(this);aF.parent().find("ul").eq(0).slideToggle(100);return false}function au(){var aF=!A.is(":visible");if(!aF){s.find("a.code").addClass("loading");H();O.getScript(mymaildata.url+"assets/js/libs/codemirror.min.js",function(){P("toggle_codeview",{content:h(),head:o.val(),_wpnonce:C},function(aG){s.find("a.code").addClass("active").removeClass("loading");K.hide();U.val(aG.content);s.find("a").not("a.redo, a.undo, a.code").addClass("disabled");y.addClass("noeditbuttons");ar=CodeMirror.fromTextArea(U.get(0),{mode:{name:"htmlmixed",scriptTypes:[{matches:/\/x-handlebars-template|\/x-mustache/i,mode:null},{matches:/(text|application)\/(x-)?vb(a|script)/i,mode:"vbscript"}]},tabMode:"indent",lineNumbers:true,viewportMargin:Infinity,autofocus:true})},function(aG,aI,aH){s.find("a.code").addClass("active").removeClass("loading");z();alert(aI+" "+aG.status+": "+aH+"\n\n"+mymailL10n.check_console)})})}else{var aE=ar.getValue();ar.clearHistory();R(aE,100,true);K.show();U.hide();O(".CodeMirror").remove();s.find("a.code").removeClass("active");s.find("a").not("a.redo, a.undo, a.code").removeClass("disabled");y.removeClass("noeditbuttons");z();x()}return false}function av(){var aE=!A.is(":visible");if(!aE){s.find("a.plaintext").addClass("active");K.hide();b.show();ab.show();s.find("a").not("a.redo, a.undo, a.plaintext, a.preview").addClass("disabled");y.addClass("noeditbuttons")}else{K.show();ab.hide();s.find("a.plaintext").removeClass("active");s.find("a").not("a.redo, a.undo, a.plaintext, a.preview").removeClass("disabled");y.removeClass("noeditbuttons");x()}return false}function ap(aE){if(aE.type=="mouseout"&&!/DIV|H3/.test(aE.target.nodeName)){return}at=y.offset();if(!D.hasClass("focus-on")){D.removeClass("focus-off").addClass("focus-on");O("#wpbody").on("mouseleave.dfw",ap);s.find("a.dfw").addClass("active");if(ac.scrollTop()<at.top){d(at.top-80)}}else{D.removeClass("focus-on").addClass("focus-off");O("#wpbody").off("mouseleave",ap);s.find("a.dfw").removeClass("active")}return false}aD();return{hide:function(){ax()}}};var ao=function(){var bg=O("#editbar"),aO,a7={img:0,single:80,multi:0,btn:0,auto:0,codeview:0},a6=bg.find(".imagepreview"),aK=bg.find(".imagewidth"),aG=bg.find(".imageheight"),bo=bg.find(".factor"),a8=bg.find(".highdpi"),aE=bg.find(".imagelink"),br=bg.find(".imageurl"),bu=bg.find(".orgimageurl"),aw=bg.find(".imagealt"),a9=bg.find(".singlelink"),bq=bg.find(".buttonlink"),aT=bg.find(".buttonlabel"),aD=bg.find(".buttonalt"),aJ=bg.find(".button-nav"),bt=bg.find("ul.buttons"),bb,aP,bi,bl,av,bh,aI,az,aS,aC,aA,aB="x",ar="",at,ap=O("#wp-mymail-editor-wrap"),be=O("#post-search"),au=O("#image-search"),aV=typeof wp!=="undefined"&&typeof wp.media!=="undefined";function bn(){bg.on("keyup change","input.live",aq).on("keyup change","#mymail-editor",aq).on("click",".replace-image",a3).on("change",".highdpi",aY).on("click","button.save",aN).on("click",".cancel",ay).on("click","a.remove",aW).on("click","a.reload",bk).on("click","a.single-link-content",aR).on("click","a.add_image",a2).on("click","a.add_image_url",aH).on("click",".imagelist li",aL).on("dblclick",".imagelist li",aN).on("change","#post_type_select input",bk).on("click",".postlist li",bd).on("click",".load-more-posts",bj).on("click","a.btnsrc",bs).on("click",".imagepreview",aM).on("click","a.nav-tab",aF).on("change","select.check-for-posts",aZ).on("keyup change","#rss_url",bk).on("keyup change","#post-search",a5).on("keyup change","#image-search",a5).on("click","#rss_url",function(){O(this).focus().select()}).on("click",".rss_change",ax).on("click","#recent_feeds a",bc).on("mouseenter","#wp-mymail-editor-wrap, .imagelist, .postlist, .CodeMirror",aX).on("mouseleave","#wp-mymail-editor-wrap, .imagelist, .postlist, .CodeMirror",bm);aj(A.contents().find("img").eq(0),function(by,bz,bA){var bx=bA>=1.5;bo.val(bA);a8.prop("checked",bx);(bx)?bg.addClass("high-dpi"):bg.removeClass("high-dpi")});aJ.on("click","a",function(){O(this).parent().find("a").removeClass("nav-tab-active");O(this).parent().parent().find("ul.buttons").hide();var bx=O(this).addClass("nav-tab-active").attr("href");O("#tab-"+bx.substr(1)).show();return false});br.on("paste change",function(by){var bx=O(this);setTimeout(function(){var bA=a4(bx.val()),bz=new Image();if(bA){aQ();bz.onload=function(){a6.attr("src",bA);bi={width:bz.width,height:bz.height,asp:bz.width/bz.height};aQ(false)};bz.onerror=function(){if(by.type!="paste"){alert(r(mymailL10n.invalid_image,'"'+bA+'"'))}};bz.src=bA}},1)});aK.on("change",function(){aG.val(Math.round(aK.val()/bi.asp))});aG.on("change",function(){aK.val(Math.round(aG.val()*bi.asp))});O("#dynamic_embed_options_post_type").on("change",function(){var bx=O("#dynamic_embed_options_cats");bx.find("select").prop("disabled",true);aQ();P("get_post_term_dropdown",{posttype:O(this).val()},function(by){aQ(false);if(by.success){bx.html(by.html);if(av&&av.terms){var bz=bx.find(".dynamic_embed_options_taxonomy_wrap");O.each(av.terms,function(bB,bA){if(!bA){return}var bC=bA.split(",");O.each(bC,function(bE,bG){var bD=bz.eq(bB).find("select").eq(bE),bF;if(!bD.length){bF=bz.eq(bB).find("select").last();bD=bF.clone();bD.insertAfter(bF);O("<span> "+mymailL10n.or+" </span>").insertBefore(bD)}bD.val(bG)})})}}aZ()},function(by,bA,bz){aQ(false);alert(bA+" "+by.status+": "+bz+"\n\n"+mymailL10n.check_console)})});bg.on("keypress.mymail",function(bx){if(bx.keyCode==13&&bx.target.nodeName.toLowerCase()!="textarea"){return false}}).on("keyup.mymail",function(bx){switch(bx.keyCode){case 27:ay();return false;break;case 13:if(aP.type!="multi"&&aP.type!="codeview"){aN();return false}break}});bg.find(".current-tag").on("click","a",function(){return false});if(bg.draggable){bg.draggable({distance:20,axis:"y"})}if(j&&tinymce.get("mymail-editor")){if(tinymce.majorVersion>=4){tinymce.get("mymail-editor").on("keyup",function(){a1(this)});tinymce.get("mymail-editor").on("ExecCommand",function(){a1(this)})}else{tinymce.get("mymail-editor").onKeyUp.add(function(){a1(this)});tinymce.get("mymail-editor").onExecCommand.add(function(){a1(this)})}}if(aV){var bv=wp.media.editor.id();var bw=wp.media.editor.get(bv);bw="undefined"!=typeof(bw)?bw:wp.media.editor.add(bv);bw.on("close",bk)}}function bp(bv){if(bg.draggable){if(bv!==false){bg.draggable("enable")}else{bg.draggable("disable")}}}function aX(){bp(false)}function bm(){bp(true)}function aF(bx,bv){var bw;if(typeof bx=="string"){bw=aO.find('a[href="'+bx+'"]')}else{bw=O(this);bx=bw.attr("href")}bw.parent().find("a.nav-tab").removeClass("nav-tab-active");bw.addClass("nav-tab-active");aO.find(".tab").hide();aO.find(bx).show();if(bx=="#dynamic_embed_options"&&bv!==false){O("#dynamic_embed_options_post_type").trigger("change")}if(bx=="#image_button"){bb="image"}if(bx=="#text_button"){bb="text"}aI=aO.find(bx).find(".postlist").eq(0);return false}function a3(){aQ();var by=bo.val(),bv=aP.element.width(),bx=Math.round(bv/1.6),bw=O("<img>",{src:"https://dummy.newsletter-plugin.com/"+(bv*by)+"x"+(bx*by)+".jpg",alt:aP.content,title:aP.content,label:aP.content,width:bv,height:bx,border:0,editable:aP.content});bw[0].onload=function(){bw.attr({width:bv,height:bx}).removeAttr("style");bf()};if(aP.element.parent().is("a")){aP.element.unwrap()}if(!aP.element.parent().is("td")){aP.element.unwrap()}aP.element.replaceWith(bw);return false}function aY(){if(O(this).is(":checked")){bo.val(2);bg.addClass("high-dpi")}else{bo.val(1);bg.removeClass("high-dpi")}}function aZ(){clearInterval(aS);aQ();O("#dynamic_embed_options").find("h4.current-match").html("&hellip;");O("#dynamic_embed_options").find("div.current-tag").html("&hellip;");aS=setTimeout(function(){var bz=bg.find("#dynamic_embed_options_post_type").val(),bw=bg.find("#dynamic_embed_options_content").val(),by=bg.find("#dynamic_embed_options_relative").val(),bx=bg.find(".dynamic_embed_options_taxonomy_wrap"),bv=[];O.each(bx,function(bC){var bB=O(this).find("select"),bA=[];O.each(bB,function(){var bD=parseInt(O(this).val(),10);if(bD!=-1&&O.inArray(bD,bA)==-1&&!isNaN(bD)){bA.push(bD)}});bA=bA.join(",");if(bA){bv[bC]=bA}});P("check_for_posts",{post_type:bz,relative:by,extra:bv},function(bA){aQ(false);if(bA.success){bl=bA.pattern;O("#dynamic_embed_options").find("h4.current-match").html(bA.title);O("#dynamic_embed_options").find("div.current-tag").text(bA.pattern.title+"\n\n"+bA.pattern[bw])}},function(bA,bC,bB){aQ(false);alert(bC+" "+bA.status+": "+bB+"\n\n"+mymailL10n.check_console)})},500);return false}function a4(bz,bw,bx){var bv;if(/^\{([a-z0-9-_]+)_image:-?[0-9,;]+(\|\d+)?\}$/.test(bz)){var by=bo.val();bz=mymaildata.ajaxurl+"?action=mymail_image_placeholder&tag="+bz.replace("{","").replace("}","")+"&w="+((bw||aK.val())*by)+"&h="+((bx||aG.val())*by)+"&f="+by}return bz}function a0(bw){if(-1!==bw.indexOf("?action=mymail_image_placeholder&tag=")){var bv=bw.match(/([a-z0-9-_]+)_image:-?[0-9,;]+(\|\d+)?/);return"{"+bv[0]+"}"}return false}function aq(bv){if((bv.keyCode||bv.which)!=27){aP.element.html(O(this).val())}}function aQ(bv){if(bv===false){O("#editbar-ajax-loading").hide();bg.find(".buttons").find("button").prop("disabled",false)}else{O("#editbar-ajax-loading").css({display:"inline"});bg.find(".buttons").find("button").prop("disabled",true)}}function aN(){if(aP.type=="img"){var bL=aP.element.is("img");if(br.val()){bi={id:null,name:"",src:a4(br.val()),width:bi.width,height:bi.height,asp:bi.width/bi.height}}if(bi){aQ();var bH=bo.val()||1,bC=bL?"src":"background";aP.element.attr({"data-id":bi.id}).data("id",bi.id).addClass("mymail-loading");if(bL){aP.element.attr({width:Math.round(aK.val()),height:Math.round(aG.val()),alt:bi.name})}if(bi.src){aP.element.attr(bC,bi.src);aP.element[0].style.cssText=aP.element[0].style.cssText.replace(/url\("?(.+)"?\)/,"url("+bi.src+")")}P("create_image",{id:bi.id,src:bi.src,width:aK.val()*bH,height:aG.val()*bH},function(bN){aQ(false);if(bN.success){a6.attr("src",bN.image.url);bN.image.width=(bN.image.width||bi.width)/bH;bN.image.height=bN.image.width/(bi.asp);bN.image.asp=bi.asp;bi=bN.image;bi.name=aw.val();if(bL){aP.element.one("load",function(){aP.element.removeClass("mymail-loading");w()});aP.element.attr({width:Math.round(aK.val()),height:Math.round(aG.val()),alt:bi.name})}else{aP.element.removeClass("mymail-loading");var bO=aP.element.html();aP.element.html(ak(bO,bu.val(),bi.url))}aP.element.removeAttr(bC).attr(bC,bi.url)}aw.val("");bf()},function(bN,bP,bO){aQ(false);alert(bP+" "+bN.status+": "+bO+"\n\n"+mymailL10n.check_console)})}else{aP.element.attr({alt:aw.val()});bf()}if(aP.element.parent().is("a")){aP.element.unwrap()}var by=aE.val();if(by){aP.element.wrap('<a href="'+by+'"></a>')}return false}else{if(aP.type=="btn"){var by=bq.val();if(!by&&!confirm(mymailL10n.remove_btn)){return false}var bx=aO.find("a.active").find("img").attr("src");if(typeof bx=="undefined"){bb="text";if(!aT.val()){aT.val(mymailL10n.read_more)}}if("image"==bb){var bH=bo.val();var bM=new Image();bM.onload=function(){if(!aP.element.find("img").length){var bO=aP.element.closest("table.textbutton");var bN=O('<a href="" editable label="'+aP.name+'"><img></a>');(bO.length)?bO.replaceWith(bN):aP.element.replaceWith(bN);aP.element=bN}aP.element.find("img").attr({src:bx,width:Math.round((bM.width||aP.element.width())/bH),height:Math.round((bM.height||aP.element.height())/bH),alt:aD.val(),title:aD.val()});(by)?aP.element.attr("href",by):aP.element.remove();bf()};bM.src=bx}else{var bA=aP.element.closest("table.textbutton"),bz=aT.val();if(!bA.length){aP.element.replaceWith('<table class="textbutton" align="left"><tr><td align="center" width="auto"><a href="'+by+'" editable label="'+bz+'">'+bz+"</a></td></tr></table>")}else{aP.element.text(bz)}if(by){aP.element.attr("href",by)}else{aP.element.remove();bA.remove()}bf()}return false}else{if(aP.type=="auto"){var bI=O("#embedoption-bar").find(".nav-tab-active").data("type");if("dynamic"==bI){var bD=bg.find("#dynamic_embed_options_content").val();bl.content=bl[bD];aP.element.attr("data-tag",bl.tag).data("tag",bl.tag)}else{if("rss"==bI){var bD=O(".embed_options_content_rss:checked").val();aP.element.removeAttr("data-tag").removeData("tag")}else{var bD=O(".embed_options_content:checked").val();aP.element.removeAttr("data-tag").removeData("tag")}}if(bl){aP.elements.headlines.html("");if(bl.title){aP.elements.headlines.eq(0).html(bl.title)}if(bl.link){if(aP.elements.buttons.length){aP.elements.buttons.last().attr("href",bl.link);aP.elements.buttons.not(":last").remove()}else{aP.elements.bodies.last().after('<buttons><table class="textbutton" align="left"><tr><td align="center" width="auto"><a href="'+bl.link+'" title="'+mymailL10n.read_more+'" editable label="'+mymailL10n.read_more+'">'+mymailL10n.read_more+"</a></td></tr></table></buttons>")}}else{if(aP.elements.buttons.parent().length&&aP.elements.buttons.parent()[0].nodeName=="TD"){aP.elements.buttons.closest("table.textbutton").remove()}else{if(aP.elements.buttons.length){if(aP.elements.buttons.last().find("img").length){aP.elements.buttons.remove()}}}}if(bl[bD]&&aP.elements.bodies.length){var bv=aP.elements.bodies.length,bF=bl[bD],bJ=bF.length,bw=(bI=="static")?Math.ceil(bJ/bv):bJ;for(var bG=0;bG<bv;bG++){aP.elements.bodies.eq(bG).html(bF.substring(bG*bw,bG*bw+bw))}}if(bl.image&&aP.elements.images.length){aQ();var bK=aP.elements.images.eq(0);var bH=bo.val();if("static"==bI){P("create_image",{id:bl.image.id,width:aP.elements.images.eq(0).width()*bH},function(bN){if(bN.success){aQ(false);bK.attr({"data-id":bl.image.id,src:bN.image.url,width:Math.round(bN.image.width/bH),height:Math.round(bN.image.height/bH),alt:bl.alt||bl.title}).data("id",bl.image.id);if(bK.parent().is("a")){bK.unwrap()}if(bl.link){bK.wrap("<a>");bK.parent().attr("href",bl.link)}}bf()},function(bN,bP,bO){aQ(false);alert(bP+" "+bN.status+": "+bO+"\n\n"+mymailL10n.check_console)});return false}else{if("rss"==bI){var bE=bK.width();bK.removeAttr("height").removeAttr("data-id").attr({src:a4(bl.image.src,bE),width:bE,alt:bl.alt||bl.title}).removeData("id")}else{var bE=bK.width();bK.removeAttr("height").removeAttr("data-id").attr({src:a4(bl.image,bE),width:bE,alt:bl.alt||bl.title}).removeData("id")}}}A.contents().find("html").find("img").each(function(){this.onload=function(){x()}})}}else{if(aP.type=="multi"){if(j&&tinymce.get("mymail-editor")&&!tinymce.get("mymail-editor").isHidden()){aP.element.html(tinymce.get("mymail-editor").getContent())}}else{if(aP.type=="single"){if(aP.conditions){aP.aa="<if";O.each(O(".conditinal-area"),function(){aP.aa=""})}if(aP.element.parent().is("a")){aP.element.unwrap()}var by=a9.val();if(by){aP.element.wrap('<a href="'+by+'"></a>')}}else{if(aP.type=="codeview"){var bB=at.getValue();aP.element.html(am(bB));aP.modulebuttons.prependTo(aP.element)}}}}}}bf();return false}function aW(){if(aP.element.parent().is("a")){aP.element.unwrap()}if(!aP.element.parent().is("td")){aP.element.unwrap()}if("btn"==aP.type){var bv=aP.element.closest("table.textbutton");if(bv.length){bv.remove()}}aP.element.remove();bf();return false}function ay(){switch(aP.type){case"img":break;case"btn":if(!aP.element.attr("href")){var bv=aP.element.closest("table.textbutton");if(bv.length){bv.remove()}aP.element.remove()}break;default:aP.element.html(aP.content)}bf();return false}function bs(){var bx=O(this),bv=bx.data("link");aO.find(".btnsrc").removeClass("active");bx.addClass("active");aD.val(bx.attr("title"));if(bv){var bw;bq.val(bv);if((bw=(bv+"").indexOf("USERNAME",0))!=-1){bq.focus();k(bq[0],bw,bw+8)}}return false}function aM(){O(this).toggleClass("zoom")}function aL(bx,bw){var bA=bw||O(this),bz=bA.data("id"),bv=bA.data("name"),by=bA.data("src");bi={id:bz,name:bv,src:by};aQ();aO.find("li.selected").removeClass("selected");bA.addClass("selected");if(aP.element.data("id")==bz){aw.val(aP.element.attr("alt"))}else{if(aP.element.attr("alt")!=bv){aw.val(bv)}}br.val("");a6.attr("src","").on("load",function(){a6.off("load");aP.width=a6.width();aP.height=a6.height();aP.asp=bA.data("asp")||(aP.width/aP.height);bi.asp=aP.asp;aQ(false);aG.val(Math.round(aK.val()/aP.asp))}).attr("src",by);return bi}function bd(){var bz=O(this),by=bz.data("id"),bv=bz.data("name"),bw=bz.data("link"),bx=bz.data("thumbid");if(aP.type=="btn"){bq.val(bw);aD.val(bv);aO.find("li.selected").removeClass("selected");bz.addClass("selected")}else{if(aP.type=="single"){a9.val(bw);aO.find("li.selected").removeClass("selected");bz.addClass("selected")}else{aQ();P("get_post",{id:by},function(bA){aQ(false);aO.find("li.selected").removeClass("selected");bz.addClass("selected");if(bA.success){bl={title:bA.title,link:bA.link,content:bA.content,excerpt:bA.excerpt,image:bA.image?{id:bA.image.id,src:bA.image.src,name:bA.image.name}:false};aO.find(".editbarinfo").html(mymailL10n.curr_selected+": <span>"+bl.title+"</span>")}},function(bA,bC,bB){aQ(false);aO.find("li.selected").removeClass("selected");alert(bC+" "+bA.status+": "+bB+"\n\n"+mymailL10n.check_console)})}}return false}function aU(bP){aP=bP;var bw=bP.element,bH=(by!="img")?bP.offset.top:0,bQ=bP.name||"",by=bP.type,bJ=O.trim(bw.html()),bK=bw.find("if"),bC,bO,bF,bA,bD=1;aO=bg.find("div.type."+by);bg.addClass("current-"+by);aP.width=bw.width();aP.height=bw.height();aP.asp=aP.width/aP.height;aP.content=bJ;av=aP.element.data("tag");if(bK.length){bC={"if":null,elseif:[],"else":null,total:0};bC=[];bg.addClass("has-conditions");bO=aO.find(".conditinal-area");bF=bg.find(".conditions").eq(0);bF.clone().prependTo(bO);O.each(bK.find("elseif"),function(){var bS=O(this),bR=bS.html();bC.push({el:bS,html:bR,field:bS.attr("field"),operator:bS.attr("operator"),value:bS.attr("value")});bS.detach();bO.clone().val(bR).insertAfter(bO)});O.each(bK.find("else"),function(){var bS=O(this),bR=bS.html();bC.push({el:bS,html:bR});bS.detach();bO.clone().val(bR).insertAfter(bO)});bC.unshift({el:bK,html:bK.html(),field:bK.attr("field"),operator:bK.attr("operator"),value:bK.attr("value")})}else{bg.removeClass("has-conditions")}aP.conditions=bC;if(by=="img"){bo.val(1);aj(bw,function(bR,bS,bT){var bS=bT>=1.5;bo.val(bT);a8.prop("checked",bS);(bS)?bg.addClass("high-dpi"):bg.removeClass("high-dpi");bD=bT})}else{if(by=="btn"){if(bw.find("img").length){O("#button-type-bar").find("a").eq(1).trigger("click");var bz=bw.find("img").attr("src");if(aJ.length){var bv=bg.find("img[src='"+bz+"']");if(bv.length){bg.find("ul.buttons").hide();var bN=bv.parent().parent().parent();bg.find('a[href="#'+bN.attr("id").substr(4)+'"]').trigger("click")}else{O.each(bg.find(".button-nav"),function(){O(this).find(".nav-tab").eq(0).trigger("click")})}}aT.val(bw.find("img").attr("alt"));aj(bw.find("img"),function(bR,bS,bT){var bS=bT>=1.5;bo.val(bT);a8.prop("checked",bS);(bS)?bg.addClass("high-dpi"):bg.removeClass("high-dpi");bD=bT})}else{O("#button-type-bar").find("a").eq(0).trigger("click");aT.val(O.trim(bw.text())).focus().select();bg.find("ul.buttons").hide()}}else{if(by=="auto"){aF("#"+(av?"dynamic":"static")+"_embed_options",true);if(av){var bI=av.substr(1,av.length-2).split(":"),bx=bI[1].split(";"),bM=parseInt(bx.shift(),10),bB=bx.length?bx:null;av={post_type:bI[0],relative:bM,terms:bB};O("#dynamic_embed_options_post_type").val(av.post_type).trigger("change");O("#dynamic_embed_options_relative").val(av.relative).trigger("change")}else{}}else{if(by=="codeview"){var bG=aO.find("textarea"),bL=bw.clone();aP.modulebuttons=bL.find(".modulebuttons");bL.find(".modulebuttons").remove();var bE=O.trim(bL.html());bG.html(bE);O.getScript(mymaildata.url+"assets/js/libs/codemirror.min.js",function(){})}}}}y.addClass("noeditbuttons");bA=y.offset().top+(aP.offset.top-(ac.height()/2)+(aP.height/2));bA=Math.max(y.offset().top-200,bA);d(bA,function(){bg.find("h4.editbar-title").html(bQ);bg.find("div.type").hide();bg.find("div."+by).show();var bV=ad.scrollTop()+(ac.height()/2)-y.offset().top-(bg.height()/2);bg.css({top:bV});aQ();if(by=="single"){if(bC){O.each(bC,function(b0,b1){var bZ=aO.find(".conditinal-area").eq(b0);bZ.find("select.condition-fields").val(b1.field);bZ.find("select.condition-operators").val(b1.operator);bZ.find("input.condition-value").val(b1.value);bZ.find("input.input").val(b1.html)})}else{var bY=bJ.replace(/&amp;/g,"&");if(aP.element.parent().is("a")){var bS=aP.element.parent().attr("href");a9.val(bS!="#"?bS:"")}else{if(aP.element.find("a").length){var bU=aP.element.find("a");if(bY==bU.text()){var bS=bU.attr("href");bY=bU.text();a9.val(bS!="#"?bS:"")}}}aO.find("input").eq(0).val(O.trim(bY))}}else{if(by=="img"){var bR=parseInt(bw[0].style.maxWidth,10)||bw.parent().width()||bw.width()||null;var bX=parseInt(bw[0].style.maxHeight,10)||bw.parent().height()||bw.height()||null;var bW=bw.attr("src")||bw.attr("background");var bT=a0(bW)||"";if(bw.parent().is("a")){aE.val(bw.parent().attr("href").replace("%7B","{").replace("%7D","}"))}aw.val(bw.attr("alt"));br.val(bT);bu.val(bW);bw.data("id",bw.attr("data-id"));O(".imageurl-popup").toggle(!!bT);a6.removeAttr("src").attr("src",bW);bh="attachment";aI=aO.find(".imagelist");bi={id:bw.data("id"),width:bw.width()*bD,height:bw.height()*bD};bi.asp=bi.width/bi.height;bk()}else{if(by=="btn"){aD.val(bw.find("img").attr("alt"));if(bw.attr("href")){bq.val(bw.attr("href").replace("%7B","{").replace("%7D","}"))}bh="link";aI=aO.find(".postlist").eq(0);bk();O.each(aO.find(".buttons img"),function(){var bZ=O(this);bZ.css("background-color",bw.css("background-color"));(bZ.attr("src")==bz)?bZ.parent().addClass("active"):bZ.parent().removeClass("active")})}else{if(by=="auto"){bh="post";aI=aO.find(".postlist").eq(0);bk();aP.elements={headlines:aP.element.find("single"),bodies:aP.element.find("multi"),buttons:aP.element.find("a[editable]"),images:aP.element.find("img[editable]")}}else{if(by=="codeview"){O.getScript(mymaildata.url+"assets/js/libs/codemirror.min.js",function(){if(at){at.clearHistory()}at=at||CodeMirror.fromTextArea(bG.get(0),{mode:{name:"htmlmixed",scriptTypes:[{matches:/\/x-handlebars-template|\/x-mustache/i,mode:null},{matches:/(text|application)\/(x-)?vb(a|script)/i,mode:"vbscript"}]},tabMode:"indent",lineNumbers:true,viewportMargin:Infinity,autofocus:true});at.setValue(bE)})}}}}}bg.show(0,function(){if(by=="single"){bg.find("input").focus().select()}else{if(by=="img"){aK.val(aP.width);aG.val(aP.height)}else{if(by=="btn"){aK.val(bR);aG.val(bX)}else{if(by=="multi"){O("#mymail-editor").val(bJ);if(j&&tinymce.get("mymail-editor")){tinymce.get("mymail-editor").setContent(bJ);tinymce.execCommand("mceFocus",false,"mymail-editor")}}}}}});aQ(false)},Math.abs(bA-ad.scrollTop()))}function bk(){var bw=O("#post_type_select").find("input:checked").serialize(),bv={type:bh,posttypes:bw,search:ar,offset:0};if(O(this).is("#rss_url")){bv.type="_rss";bv.url=O.trim(O("#rss_url").val());if(bv.url==aB){return false}aB=bv.url;if(!bv.url){O("#rss_more").slideUp(200);return false}O(".rss_info").html("")}if(bh=="attachment"){bv.id=bi.id}aI.empty();aQ();P("get_post_list",bv,function(bx){aQ(false);if(bx.success){az=bx.itemcount;ba(bx.html,true);aI.find(".selected").trigger("click");if(bx.rssinfo){O("#rss_more").slideDown(200);O("#rss_input").slideUp(200);O(".rss_info").html("<h4>"+bx.rssinfo.title+" &ndash; "+bx.rssinfo.description+'</h4><p class="tiny">'+bx.rssinfo.copyright+"</p>")}}},function(bx,bz,by){aQ(false);alert(bz+" "+bx.status+": "+by+"\n\n"+mymailL10n.check_console)})}function bj(){var bx=O(this),by=bx.data("offset"),bv=bx.data("type");aQ();var bw=O("#post_type_select").find("input:checked").serialize();P("get_post_list",{type:bv,posttypes:bw,search:ar,offset:by,url:O.trim(O("#rss_url").val()),itemcount:az},function(bz){aQ(false);if(bz.success){az=bz.itemcount;bx.parent().remove();ba(bz.html,false)}},function(bz,bB,bA){aQ(false);alert(bB+" "+bz.status+": "+bA+"\n\n"+mymailL10n.check_console)});return false}function a5(){var bv=O(this);clearTimeout(aC);aC=setTimeout(function(){var bw=bv.val();if(bw==ar){return}ar=bw;bk()},300)}function aR(){O("#single-link").slideDown(200);a9.focus().select();bh="link";aI=aO.find(".postlist").eq(0);bk();return false}function ba(bw,bv,bx){if(!bx){bx=aI}if(bv){bx.empty()}if(!bx.html()){bx.html("<ul></ul>")}bx.find("ul").append(bw)}function bc(){O("#rss_url").val(O(this).attr("href")).trigger("change");return false}function ax(){O("#rss_url").val("");O("#rss_more").slideUp(200);O("#rss_input").slideDown(200);return false}function aH(){O(".imageurl-popup").toggle();br.focus().select();return false}function a2(){if(aV){var bv=wp.media.editor.send.attachment;wp.media.editor.send.attachment=function(bx,by){var bw=O("img");bw.data({id:by.id,name:by.name,src:by.url});wp.media.editor.send.attachment=bv;aL(null,bw)};wp.media.editor.open()}return false}function a1(bv){clearTimeout(ag);ag=setTimeout(function(){if(!bv){return}var bw=O.trim(bv.save());aP.element.html(bw)},100)}function bf(){bg.removeClass("current-"+aP.type).hide();aQ(false);O("#single-link").hide();w();x();return false}bn();return{open:function(bv){aU(bv)},close:function(){bf()}}};var an=function(){var aw=O("#mymail_template"),aG=O("#module-selector"),aF=O("a.toggle-modules"),aC=A.contents().find("modules"),aA=A.contents().find("body"),aI=aC.find("module"),aD,at={},aE=!!parseInt(window.getUserSetting("mymailshowmodules",1),10);function av(){var aL=aG.data("current");aq(O(this).data("id"),((aL&&aL.is("module"))?aL:false),true);return false}function ay(){var aL=O(this).parent().parent().parent();aL.insertBefore(aL.prev("module"));x();w();return false}function az(){var aL=O(this).parent().parent().parent();aL.insertAfter(aL.next("module"));x();w();return false}function ar(){var aL=O(this).parent().parent().parent(),aN=aL.clone().hide();y.addClass("noeditbuttons");aN.insertAfter(aL);M(0,0);aN.slideDown(function(){aN.css("display","block");x();w()});var aM=aN.offset().top+y.offset().top-(ac.height()/2)-aN.outerHeight();aM=Math.max(y.offset().top,aM);d(aM);return false}function ax(){var aL=O(this).parent().parent().parent();var aM={element:aL,name:aL.attr("label"),type:"auto",offset:aL.offset()};J.open(aM);return false}function aB(){var aN=O(this),aM=aN.val(),aL=aN.parent().parent();if(!aM){aM=aN.attr("placeholder");aN.val(aM)}aL.attr("label",aM)}function aK(){var aL=O(this).parent().parent().parent();aL.fadeTo(100,0,function(){y.addClass("noeditbuttons");aL.slideUp(200,function(){aL.remove();aI=A.contents().find("module");if(!aI.length){aC.html("")}x();w()})});return false}function aq(aQ,aL,aM,aN){if(!at[aQ]){return false}var aP=at[aQ].el.clone();y.addClass("noeditbuttons");(aL)?(aM?aP.hide().insertBefore(aL):aP.hide().insertAfter(aL)):aP.hide().appendTo(aC);M(0,0);aP.slideDown(200,function(){aP.addClass("active").css("display","block");x();w()});if(!aN){var aO=aP.offset().top+y.offset().top-(ac.height()/2)-aP.outerHeight();aO=Math.max(y.offset().top,aO);d(aO)}}function ap(){var aL=O(this).parent().parent().parent();var aM={element:aL,name:aL.attr("label"),type:"codeview",offset:aL.offset()};J.open(aM);return false}function aJ(){V.toggleClass("show-modules");aE=!aE;window.setUserSetting("mymailshowmodules",aE?1:0);x()}function aH(){y.on("click","a.toggle-modules",aJ).on("click","a.addmodule",av);au()}function au(){aI=A.contents().find("module");if(!aI.length){aC.html("")}aD=O(Z.val()).add(aI);if(!aD.length){aG.remove();return}aC=A.contents().find("modules");aC.on("click","a.up",ay).on("click","a.down",az).on("click","a.auto",ax).on("click","a.duplicate",ar).on("click","a.remove",aK).on("click","a.codeview",ap).on("change","input.modulelabel",aB);var aP="",aL="",aO=0;at=[];O.each(aD,function(aU){var aW=O(this);if(aW.is("module")){var aT=aW.attr("label"),aV=mymaildata.codeview?'<a class="mymail-btn codeview" title="'+mymailL10n.codeview+'"></a>':"",aX=(aW.is("[auto]")?'<a class="mymail-btn auto" title="'+mymailL10n.auto+'"></a>':"");O('<div class="modulebuttons"><span>'+aX+'<a class="mymail-btn duplicate" title="'+mymailL10n.duplicate_module+'"></a><a class="mymail-btn up" title="'+mymailL10n.move_module_up+'"></a><a class="mymail-btn down" title="'+mymailL10n.move_module_down+'"></a>'+aV+'<a class="mymail-btn remove" title="'+mymailL10n.remove_module+'"></a></span><input class="modulelabel" type="text" value="'+aT+'" placeholder="'+aT+'" title="'+mymailL10n.module_label+'" tabindex="-1"></div>').prependTo(aW);if(!aW.parent().length){at.push({name:aT,el:aW})}}});var aR,aN,aM=O("<dropzone></dropzone>"),aS=aM.clone(),aQ=aM.add(aS);if(!O._data(aG[0],"events")){aG.on("dragstart.mymail","li",function(aT){window.mymail_is_modulde_dragging=true;aT.originalEvent.dataTransfer.setData("Text",this.id);y.addClass("noeditbuttons");aA.addClass("drag-active");aN=O(aT.target).data("id");aC.on("dragenter.mymail",function(aU){var aV=O(aU.target).closest("module");if(!aV.length||aR&&aR[0]===aV[0]){return}aR=aV;aS.appendTo(aR);aM.prependTo(aR);setTimeout(function(){aS.addClass("visible");aM.addClass("visible");aI.removeClass("drag-up drag-down");aV.prevAll("module").addClass("drag-up");aV.nextAll("module").addClass("drag-down")},1)}).on("dragover.mymail",function(aU){aU.preventDefault()}).on("drop.mymail",function(aU){aq(aN,aI.length?(aR&&aR[0]===aC?false:aR):false,aM[0]===aU.target,true);aI=A.contents().find("module");aU.preventDefault()});aQ.on("dragenter.mymail",function(aU){O(this).addClass("drag-over")}).on("dragleave.mymail",function(aU){O(this).removeClass("drag-over")})}).on("dragend.mymail","li",function(aT){aR=null;aA.removeClass("drag-active");aQ.removeClass("visible drag-over").remove();aI.removeClass("drag-up drag-down");aC.off("dragenter.mymail").off("dragover.mymail").off("drop.mymail");aQ.off("dragenter.mymail").off("dragleave.mymail");window.mymail_is_modulde_dragging=false})}x()}aH();return{refresh:function(){au()}}};function d(ar,aq,ap){if(isNaN(ap)){ap=400}if(ad.scrollTop()==ar){aq&&aq();return}ad.animate({scrollTop:ar},ap,aq&&function(){aq()})}function x(){clearTimeout(B);B=setTimeout(function(){M();if(!f){if(A[0].contentWindow.window.mymail_refresh){A[0].contentWindow.window.mymail_refresh()}q()}else{e()}},10)}function M(ap,aq){if(!E){return false}setTimeout(function(){if(!A[0].contentWindow.document.body){return}var ar=A[0].contentWindow.document.body.offsetHeight||A.contents().find("html")[0].innerHeight||A.contents().find("html").height();A.attr("height",Math.max(500,ar+10+(ap||0)))},aq?aq:500)}function w(){if(!f&&E){var ar=v();var aq=F.length,ap=F[aq];if(ap!=ar){U.val(ar);X.prop("readonly",!ar.match("{preheader}"));F=F.splice(0,al+1);F.push(o.val()+ar);if(aq>=mymailL10n.undosteps){F.shift()}al=F.length-1;if(al){s.find("a.undo").removeClass("disabled")}s.find("a.redo").addClass("disabled")}}}function q(){y.find(".content.mymail-btn").remove();var ap=A.contents().find("html");var ar=ap.find("buttons"),aq=ap.find("[repeatable]");if(!ap){return}setTimeout(function(){if(!O._data(ap[0],"events")){ap.off(".mymail").on("click.mymail","multi, single",function(av){av.stopPropagation();var ay=O(this),az=ay.offset(),ax=az.top+40,aw=az.left,at=ay.attr("label"),au=ay.prop("tagName").toLowerCase();J.open({offset:az,type:au,name:at,element:ay})}).on("click.mymail","img[editable]",function(av){av.stopPropagation();var ay=O(this),az=ay.offset(),ax=az.top+61,aw=az.left,at=ay.attr("label"),au="img";J.open({offset:az,type:au,name:at,element:ay})}).on("click.mymail","td[background]",function(av){av.stopPropagation();if(av.target.tagName.toLowerCase()=="module"||this==ap.find("table").eq(0).find("td")[0]){return}var ay=O(this),az=ay.offset(),ax=az.top+61,aw=az.left,at=ay.attr("label"),au="img";J.open({offset:az,type:au,name:at,element:ay})}).on("click.mymail","a[editable]",function(av){av.stopPropagation();av.preventDefault();var ay=O(this),az=ay.offset(),ax=az.top+40,aw=az.left,at=ay.attr("label"),au="btn";J.open({offset:az,type:au,name:at,element:ay})})}O.each(ar,function(){var ax=O(this),at=ax.attr("label"),ay=this.getBoundingClientRect(),aw=ay.top+46,av=ay.right+16,au;au=O('<a class="addbutton content mymail-btn" title="'+mymailL10n.add_button+'"></a>').css({top:aw,left:av}).appendTo(y);au.data("offset",ay).data("name",at);au.data("element",ax)});O.each(aq,function(){var ax=O(this),at=ax.attr("label"),ay=this.getBoundingClientRect(),aw=ay.top+48,av=ay.right,au;au=O('<a class="addrepeater content mymail-btn" title="'+r(mymailL10n.add_s,at)+'"></a>').css({top:aw-3,left:av+18}).appendTo(y);au.data("offset",ay).data("name",at);au.data("element",ax);au=O('<a class="removerepeater content mymail-btn" title="'+r(mymailL10n.remove_s,at)+'"></a>').css({top:aw+18,left:av+18}).appendTo(y);au.data("offset",ay).data("name",at);au.data("element",ax)});y.removeClass("noeditbuttons")},500)}function e(ap){y.find(".clickbadge").remove();var ap=ap||O("#mymail_click_stats").data("stats"),aq=parseInt(ap.total,10);if(!aq){return}O.each(ap.clicks,function(at,ar){O.each(ar,function(aw,aA){var az=A.contents().find('a[href="'+at.replace("&amp;","&")+'"]').eq(aw);if(az.length){az.css({display:"inline-block"});var av=az.offset(),ay=av.top,au=av.left+5,aC=(aA.clicks/aq)*100,aB=(aC<1?"&lsaquo;1":Math.round(aC))+"%",ax=O('<a class="clickbadge '+(aC<40?"clickbadge-outside":"")+'" data-p="'+aC+'" data-link="'+at+'" data-clicks="'+aA.clicks+'" data-total="'+aA.total+'"><span style="width:'+(Math.max(0,aC-2))+'%">'+(aC<40?"&nbsp;":aB)+"</span>"+(aC<40?" "+aB:"")+"</a>").css({top:ay,left:au}).appendTo(y)}})})}function N(av,au,ar){if(!av){av=au}if(!au){return false}if(av==au){return false}var aq=h(),at=new RegExp(av,"gi"),ap=Z.val();if(ar){ar.data("value",au)}Z.val(ap.replace(at,au));O("#mymail-color-"+av.substr(1).toLowerCase()).attr("id","mymail-color-"+au.substr(1).toLowerCase());R(aq.replace(at,au),3000)}function ak(ar,ap,aq){if(ap===aq){return ar}do{ar=ar.replace(ap,aq)}while(ar.indexOf(ap)!==-1);return ar}function Y(ar){var ap=h(),aq=ap.replace(/body{background-image:url\(.*}/i,"");if(ar){var at=(ar)?"\tbody{background-image:url('"+ar+"');background-repeat:repeat-y no-repeat;background-position:top center;}":"",aq=aq.replace(/<style.*?>/i,'<style type="text/css">'+at).replace(/<td/i,'<td background="'+ar+'"');O("ul.backgrounds > li > a").css({"background-image":"url('"+ar+"')"})}else{var au=aq.match(/<td(.*)background="[^"]*"(.*)/i);if(au){aq=aq.replace(au[0],"<td "+au[1]+" "+au[2])}O("ul.backgrounds > li > a").css({"background-image":"none"})}R(aq);return}function I(aq){var ar=h(),at=/\/img\/version(\d+)\//g,au="/img/"+aq+"/";html=ar.replace(at,au);var ap=Z.val();Z.val(ap.replace(at,au));R(html);return}function H(ap){ai=true;O("#publishing-action").find("input").prop("disabled",true);O(".button").prop("disabled",true);if(ap!==true){O("input").prop("disabled",true)}}function z(){O("#publishing-action").find("input").prop("disabled",false);O(".button").prop("disabled",false);O("input").prop("disabled",false);ai=false}function v(){var ap=A[0].contentWindow.document.body;if(typeof ap=="null"||!ap){return""}var at=O.trim(ap.innerHTML);var au=ap.attributes,aq=au.length,ar="";while(aq--){ar=" "+au[aq].name+'="'+au[aq].value+'"'+ar}ar=ar.replace("position: relative;","").replace(' class=""',"").replace(' style=""',"");return o.val()+"\n<body"+ar+">\n"+at+"\n</body>\n</html>"}function h(){return U.val()||v()}function R(au,ar,at){var aq=au.match(/([^]*)<body([^>]*)?>([^]*)<\/body>([^]*)/m),au=aq[3],aw=O.trim(aq[1]),az=O("<div"+(aq[2]||"")+"></div>")[0].attributes,ax=az.length,ay=(O.browser.webkit||O.browser.mozilla)?A[0].contentWindow.document:n,ap=O(ay).find("head").find("link"),av=ay.getElementsByTagName("head")[0];o.val(aw);av.innerHTML=aw.replace(/([^]*)<head([^>]*)?>([^]*)<\/head>([^]*)/m,"$3");O(av).append(ap);ay.body.innerHTML=am(au);while(ax--){ay.body.setAttribute(az[ax].name,az[ax].value)}if(ar!==false){clearTimeout(ag);ag=setTimeout(function(){G.refresh()},ar||100)}if(typeof at=="undefined"||at===true){w()}}function am(ap){return ap}function Q(){return S.val()+U.val()+b.val()+L.val()+X.val()}function P(at,ar,au,aq,ap){if(O.isFunction(ar)){if(O.isFunction(au)){aq=au}au=ar;ar={}}O.ajax({type:"POST",url:ajaxurl,data:O.extend({action:"mymail_"+at,_wpnonce:C},ar),success:function(aw,ax,av){au&&au.call(this,aw,ax,av)},error:function(av,ax,aw){if(ax=="error"&&!aw){return}if(console){console.error(O.trim(av.responseText))}aq&&aq.call(this,av,ax,aw)},dataType:ap?ap:"JSON"})}function p(ap){return O.trim(ap).toLowerCase().replace(/ /g,"_").replace(/[^a-z0-9_-]*/g,"")}function ae(){var aD,az,av,aq,aw=new Date(),ap=O(".time"),ar=O(".deliverytime").eq(0),ay=O("#mymail_data_active"),aC=parseInt(ap.data("timestamp"),10)*1000,aB=true,at=aC-aw.getTime()+(aw.getTimezoneOffset()*60000);var au=(aB)?1000:20000;function aA(){aD=new Date();aw=aD.getTime();aD.setTime(aw+at);av=aD.getHours();aq=aD.getMinutes();if(!f&&az&&aq!=az[1]&&!ay.is(":checked")){ar.val(ax(av)+":"+ax(aq))}az=[];az.push(aD.getHours());az.push(aD.getMinutes());if(aB){az.push(aD.getSeconds())}for(var aE=0;aE<3;aE++){az[aE]=ax(az[aE])}ap.html(az.join('<span class="blink">:</span>'));setTimeout(function(){aA()},au)}function ax(aE){return(aE<10)?"0"+aE:aE}aA()}function r(){var ap=Array.prototype.slice.call(arguments),aq=ap.shift();while(ap.length){aq=aq.replace("%s",ap.shift())}return aq}function aj(aq,at){aq=aq.eq(0);if(aq.is("img")&&aq.attr("src")){var ar=new Image(),ap;ar.onload=function(){ap=((ar.width/aq.width()).toFixed(1)||1);if(at){at.call(this,ar.width,ar.height,isFinite(ap)?parseFloat(ap):1)}};ar.src=aq.attr("src")}}function l(ar,aq,ap,at){return(at===false?"":"#")+((1<<24)+(ar<<16)+(aq<<8)+ap).toString(16).slice(1)}if(document.selection&&document.selection.createRange){k=function(aq,at,ar){aq.focus();aq.select();var ap=document.selection.createRange();ap.collapse(true);ap.moveEnd("character",ar);ap.moveStart("character",at);ap.select();return true}}else{k=function(ap,ar,aq){ap.selectionStart=ar;ap.selectionEnd=aq;return true}}if(window.getSelection){u=function(aq){var at="";if(document.activeElement&&(document.activeElement.tagName.toLowerCase()=="textarea"||document.activeElement.tagName.toLowerCase()=="input")){var ar=document.activeElement.value;at=ar.substring(document.activeElement.selectionStart,document.activeElement.selectionEnd)}else{var ap=window.getSelection();at=ap.toString()}return at}}else{u=function(aq){var ar="";if(document.selection.createRange){var ap=document.selection.createRange();ar=ap.text}return ar}}ah()});